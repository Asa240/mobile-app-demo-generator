<!DOCTYPE html>
<!-- GitHub Pages Ready - Mobile App Demo Generator v3.0 -->
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mobile App Demo Generator</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: 1fr 400px;
            gap: 30px;
            height: calc(100vh - 40px);
        }

        @media (max-width: 1200px) {
            .container {
                grid-template-columns: 1fr 350px;
                gap: 20px;
            }
        }

        @media (max-width: 900px) {
            .container {
                grid-template-columns: 1fr;
                gap: 20px;
            }
        }

        .config-panel {
            background: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            overflow-y: auto;
        }

        .preview-panel {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            display: flex;
            flex-direction: column;
        }

        .section {
            margin-bottom: 30px;
        }

        .section-title {
            font-size: 18px;
            font-weight: bold;
            color: #333;
            margin-bottom: 15px;
            border-bottom: 2px solid #667eea;
            padding-bottom: 8px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #555;
        }

        input,
        select,
        textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s;
        }

        input:focus,
        select:focus,
        textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .color-picker {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .color-input {
            width: 60px !important;
            height: 40px;
            padding: 0;
            border: none;
            border-radius: 8px;
            cursor: pointer;
        }

        .industry-templates {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .template-card {
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
        }

        .template-card:hover {
            border-color: #667eea;
            transform: translateY(-2px);
        }

        .template-card.selected {
            border-color: #667eea;
            background: #f0f4ff;
        }

        .template-icon {
            font-size: 32px;
            margin-bottom: 10px;
        }

        .template-name {
            font-weight: 600;
            margin-bottom: 5px;
        }

        .template-desc {
            font-size: 12px;
            color: #666;
        }

        .preview-container {
            flex: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            background: #f8f9fa;
            border-radius: 8px;
            margin-bottom: 20px;
            overflow: hidden;
        }

        .phone-container {
            width: 325px;
            height: 650px;
            background: #000;
            border-radius: 32px;
            padding: 6px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            position: relative;
        }

        .phone-screen {
            width: 100%;
            height: 100%;
            background: #fff;
            border-radius: 26px;
            overflow: hidden;
            position: relative;
        }

        .status-bar {
            height: 44px;
            background: var(--primary-color, #1a365d);
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 20px;
            color: white;
            font-size: 14px;
            font-weight: 600;
        }

        #demoScreenFooter {
            font-family: 'SF Pro Text', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--primary-color, #1a365d);
        }

        .app-header {
            background: linear-gradient(135deg, var(--primary-color, #1a365d) 0%, var(--secondary-color, #2d5aa0) 100%);
            color: white;
            padding: 20px;
            text-align: center;
        }

        .logo {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .tagline {
            font-size: 14px;
            opacity: 0.9;
        }

        .main-content {
            padding: 24px;
            height: calc(100% - 140px);
            overflow-y: auto;
        }

        .welcome-title {
            font-size: 28px;
            font-weight: bold;
            color: var(--primary-color, #1a365d);
            margin-bottom: 8px;
            text-align: center;
        }

        .welcome-subtitle {
            font-size: 16px;
            color: #666;
            line-height: 1.5;
            text-align: center;
            margin-bottom: 20px;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e2e8f0;
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 12px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #48bb78, #38a169);
            width: 65%;
            transition: width 1s ease;
        }

        .action-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
        }

        .action-card {
            background: white;
            border-radius: 16px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            border: 1px solid #e2e8f0;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .action-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.12);
        }

        .action-icon {
            width: 48px;
            height: 48px;
            background: linear-gradient(135deg, var(--accent-color, #4299e1), #3182ce);
            border-radius: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 12px;
            box-shadow: 0 4px 12px rgba(66, 153, 225, 0.2);
            transition: all 0.3s ease;
            color: white;
        }

        .action-title {
            font-size: 16px;
            font-weight: 600;
            color: var(--primary-color, #1a365d);
            margin-bottom: 4px;
        }

        .action-desc {
            font-size: 12px;
            color: #666;
        }

        .btn {
            background: var(--accent-color, #4299e1);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            width: 100%;
        }

        .btn-generate {
            background: #667eea;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            width: 100%;
        }

        .btn-generate:hover {
            background: #5a67d8;
            transform: translateY(-1px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        /* Floating Launch Demo Button */
        .floating-launch-btn-container {
            position: fixed;
            bottom: 30px;
            right: 30px;
            z-index: 9999;
        }

        .floating-launch-btn {
            background: #ff1493;
            color: white;
            border: none;
            padding: 16px 40px;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(255, 20, 147, 0.3), 0 2px 4px rgba(255, 20, 147, 0.2);
            white-space: nowrap;
            min-width: 180px;
        }

        .floating-launch-btn:hover {
            background: #e91e63;
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(255, 20, 147, 0.4), 0 3px 6px rgba(255, 20, 147, 0.3);
        }

        .floating-launch-btn:active {
            transform: translateY(0);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15), 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        /* URL History Dropdown Styles */
        .url-input-container {
            position: relative;
        }

        .url-history-dropdown {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 1px solid #ddd;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            z-index: 1000;
            max-height: 200px;
            overflow-y: auto;
            margin-top: 4px;
        }

        .url-history-item {
            padding: 12px 16px;
            cursor: pointer;
            border-bottom: 1px solid #f0f0f0;
            font-size: 14px;
            color: #333;
            transition: background-color 0.2s ease;
        }

        .url-history-item:hover {
            background-color: #f8f9fa;
        }

        .url-history-item:last-child {
            border-bottom: none;
        }

        .url-history-item .url-text {
            word-break: break-all;
            line-height: 1.4;
        }

        .url-history-item .url-date {
            font-size: 12px;
            color: #666;
            margin-top: 4px;
        }

        .url-history-clear {
            padding: 8px 16px;
            text-align: center;
            color: #dc3545;
            font-size: 12px;
            cursor: pointer;
            border-top: 1px solid #f0f0f0;
        }

        .url-history-clear:hover {
            background-color: #fff5f5;
        }

        /* Modal Styles */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 10003;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background: white;
            border-radius: 12px;
            max-width: 800px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 30px;
            border-bottom: 1px solid #e9ecef;
        }

        .modal-header h2 {
            margin: 0;
            color: #333;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #666;
            padding: 0;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: background-color 0.2s;
        }

        .modal-close:hover {
            background-color: #f8f9fa;
        }

        .modal-body {
            padding: 30px;
        }

        /* Demo Mode Styles */
        .demo-mode {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: #f8f9fa;
            z-index: 10000;
            display: none;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .demo-mode.active {
            display: flex;
        }

        .demo-phone-container {
            width: 400px;
            height: 800px;
            background: #000;
            border-radius: 32px;
            padding: 7px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            position: relative;
            margin: 0 auto;
        }

        .demo-phone-screen {
            width: 100%;
            height: 100%;
            background: #fff;
            border-radius: 25px;
            overflow: hidden;
            position: relative;
        }

        .demo-controls {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(15px);
            border-radius: 16px;
            padding: 16px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.12);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 10001;
            min-width: 50px;
            max-width: 280px;
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .demo-controls.collapsed {
            max-width: 50px;
            padding: 8px;
            background: transparent;
            backdrop-filter: none;
            box-shadow: none;
            border: none;
        }

        .demo-controls.collapsed .demo-controls-header,
        .demo-controls.collapsed .demo-controls-buttons {
            opacity: 0;
            transform: translateX(20px);
            pointer-events: none;
        }

        .demo-controls.collapsed .demo-toggle-btn {
            opacity: 1;
            transform: translateX(0);
            pointer-events: all;
        }

        .demo-controls-header {
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 12px;
            transition: all 0.3s ease;
        }

        .demo-controls-title {
            font-size: 14px;
            font-weight: 700;
            color: #333;
            white-space: nowrap;
        }

        .demo-controls-buttons {
            display: flex;
            flex-direction: column;
            gap: 8px;
            transition: all 0.3s ease;
        }

        .demo-control-btn {
            background: linear-gradient(135deg, #667eea, #5a67d8);
            color: white;
            border: none;
            padding: 10px 16px;
            border-radius: 8px;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            white-space: nowrap;
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3);
        }

        .demo-control-btn:hover {
            background: linear-gradient(135deg, #5a67d8, #4c51bf);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        .demo-toggle-btn {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(135deg, #667eea, #5a67d8);
            color: white;
            border: none;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            opacity: 0;
            pointer-events: none;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }

        .demo-toggle-btn:hover {
            background: linear-gradient(135deg, #5a67d8, #4c51bf);
            transform: translate(-50%, -50%) scale(1.1);
            box-shadow: 0 6px 16px rgba(102, 126, 234, 0.4);
        }

        .device-size-selector {
            margin: 8px 0;
            padding: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 6px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .device-size-selector label {
            display: block;
            font-size: 11px;
            font-weight: 600;
            color: #333;
            margin-bottom: 4px;
            white-space: nowrap;
        }

        .device-size-selector select {
            width: 100%;
            padding: 6px 8px;
            border: 1px solid rgba(102, 126, 234, 0.3);
            border-radius: 4px;
            font-size: 11px;
            background: white;
            color: #333;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .device-size-selector select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 2px rgba(102, 126, 234, 0.2);
        }

        .demo-exit-btn {
            background: linear-gradient(135deg, #343a40, #495057);
            color: white;
            border: none;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            padding: 10px 16px;
            border-radius: 8px;
            transition: all 0.3s ease;
            white-space: nowrap;
            box-shadow: 0 2px 8px rgba(52, 58, 64, 0.3);
            width: 100%;
        }

        .demo-exit-btn:hover {
            background: linear-gradient(135deg, #495057, #6c757d);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(52, 58, 64, 0.4);
        }

        .btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .btn-secondary {
            background: #6c757d;
            margin-top: 10px;
        }

        .notification {
            position: absolute;
            top: 20px;
            right: 20px;
            background: white;
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            max-width: 300px;
            font-size: 12px;
            z-index: 1000;
        }

        .notification-title {
            font-weight: 600;
            margin-bottom: 5px;
        }

        .notification-message {
            color: #666;
        }

        .hidden {
            display: none;
        }

        /* App Screenshot Styles */
        .image-preview-container {
            background: #f8f9fa;
            border: 2px dashed #dee2e6;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            transition: all 0.3s ease;
        }

        .image-preview-container:hover {
            border-color: #667eea;
            background: #f0f4ff;
        }

        .image-preview {
            max-width: 100%;
            max-height: 200px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease;
        }

        .image-preview:hover {
            transform: scale(1.02);
        }

        .image-size-info {
            margin-top: 8px;
            font-size: 12px;
            color: #666;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .image-size-info .current-size {
            font-weight: 600;
            color: #333;
        }

        .image-size-info .recommended-size {
            color: #667eea;
        }

        /* Preview Controls Styles */
        .preview-btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            white-space: nowrap;
        }

        .preview-btn:hover {
            background: #5a67d8;
            transform: translateY(-1px);
        }

        .preview-btn:active {
            transform: translateY(0);
        }

        /* Push Notification Styles for Preview */
        .push-notification {
            position: absolute;
            top: 44px;
            left: 8px;
            right: 8px;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-radius: 16px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.12), 0 1px 3px rgba(0, 0, 0, 0.08);
            padding: 12px;
            margin: 8px;
            z-index: 1000;
            transform: translateY(-120px);
            opacity: 0;
            transition: all 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .push-notification.show {
            transform: translateY(0);
            opacity: 1;
        }

        .notification-header {
            display: flex;
            align-items: center;
            margin-bottom: 6px;
        }

        .notification-icon {
            width: 28px;
            height: 28px;
            background: linear-gradient(135deg, var(--accent-color, #4299e1), #3182ce);
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 10px;
            font-size: 14px;
            box-shadow: 0 2px 4px rgba(66, 153, 225, 0.2);
        }

        .notification-app {
            font-size: 13px;
            font-weight: 600;
            color: var(--primary-color, #1a365d);
        }

        .notification-time {
            font-size: 11px;
            color: #a0aec0;
            margin-left: auto;
        }

        .notification-title {
            font-size: 15px;
            font-weight: 700;
            color: var(--primary-color, #1a365d);
            margin-bottom: 2px;
            line-height: 1.2;
        }

        .notification-message {
            font-size: 13px;
            color: #4a5568;
            line-height: 1.3;
            margin-bottom: 10px;
        }

        .notification-actions {
            display: flex;
            gap: 6px;
        }

        .notification-btn {
            flex: 1;
            padding: 6px 10px;
            border: none;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            -webkit-tap-highlight-color: transparent;
        }

        .notification-btn.primary {
            background: linear-gradient(135deg, var(--accent-color, #4299e1), #3182ce);
            color: white;
            box-shadow: 0 2px 4px rgba(66, 153, 225, 0.2);
        }

        .notification-btn.secondary {
            background: rgba(247, 250, 252, 0.8);
            color: #4a5568;
            border: 1px solid rgba(226, 232, 240, 0.6);
        }

        /* Chat Overlay Styles for Preview */


        .bottom-overlay {
            position: absolute;
            top: calc(100% - 55px);
            /* Start where chat overlay ends */
            left: 6px;
            /* Stay inside black trim */
            right: 6px;
            /* Stay inside black trim */
            bottom: 6px;
            /* Stay inside black trim */
            background: white;
            z-index: 1001;
            display: none;
            border-radius: 0px 0px 26px 26px;
        }

        .chat-overlay {
            position: absolute;
            top: 44px;
            /* Align with status bar */
            left: 6px;
            /* Stay inside black trim */
            right: 6px;
            /* Stay inside black trim */
            bottom: 55px;
            /* Pull up from bottom by 55px */
            background: white;
            z-index: 1000;
            display: none;
            justify-content: center;
            align-items: center;
            border-radius: 8px 8px 0 0;
            padding: 0;
        }

        /* Full width chat overlay for screenshot mode */
        .chat-overlay.screenshot-mode {
            left: 0;
            right: 0;
            border-radius: 0;
        }

        .chat-container {
            width: 100%;
            height: 100%;
            background: white;
            border-radius: 0;
            box-shadow: none;
            overflow: hidden;
            position: relative;
            margin: 0;
        }

        /* Demo Mode Chat Overlay Styles */
        .demo-mode .chat-overlay {
            position: absolute;
            top: 44px;
            /* Align with status bar */
            left: 0;
            /* Full width in demo mode */
            right: 0;
            /* Full width in demo mode */
            bottom: 55px;
            /* Pull up from bottom by 55px */
            background: white;
            z-index: 1000;
            display: none;
            justify-content: center;
            align-items: center;
            border-radius: 0;
            padding: 0;
            box-shadow: none;
        }

        .chat-overlay.active {
            display: flex;
        }

        .chat-container {
            width: 100%;
            height: 100%;
            background: white;
            border-radius: 0;
            box-shadow: none;
            overflow: hidden;
            position: relative;
            margin: 0;
        }

        /* Demo Mode Chat Container Styles */
        .demo-mode .chat-container {
            width: 100%;
            height: 100%;
            background: white !important;
            border-radius: 0;
            box-shadow: none;
            overflow: hidden;
            position: relative;
            margin: 0;
        }

        /* Demo Mode Bottom Overlay Styles */
        .demo-mode .bottom-overlay {
            position: absolute;
            top: calc(100% - 55px);
            /* Start where chat overlay ends */
            left: 0;
            /* Full width in demo mode */
            right: 0;
            /* Full width in demo mode */
            bottom: 0;
            /* Extend to bottom */
            background: white;
            z-index: 1001;
            display: none;
            border-radius: 0;
        }



        .chat-header {
            background: linear-gradient(135deg, var(--primary-color, #1a365d) 0%, var(--secondary-color, #2d5aa0) 100%);
            color: white;
            padding: 14px 18px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        /* Demo Mode Chat Header Styles */
        .demo-mode .chat-header {
            background: linear-gradient(135deg, var(--primary-color, #1a365d) 0%, var(--secondary-color, #2d5aa0) 100%);
            color: white;
            padding: 14px 18px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
        }

        .chat-title {
            font-size: 15px;
            font-weight: 600;
        }

        .chat-close {
            background: none;
            border: none;
            color: white;
            font-size: 20px;
            cursor: pointer;
            padding: 4px;
            border-radius: 4px;
            transition: background 0.2s ease;
        }

        .chat-content {
            height: calc(100% - 56px);
            position: relative;
        }

        /* Toggle Switch Styles */
        .toggle-container {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .toggle-switch {
            position: relative;
            width: 50px;
            height: 24px;
            background-color: #e1e5e9;
            border-radius: 24px;
            cursor: pointer;
            transition: background-color 0.3s ease;
            flex-shrink: 0;
        }

        .toggle-switch.active {
            background-color: #667eea;
        }

        .toggle-switch::before {
            content: '';
            position: absolute;
            top: 2px;
            left: 2px;
            width: 20px;
            height: 20px;
            background-color: white;
            border-radius: 50%;
            transition: transform 0.3s ease;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .toggle-switch.active::before {
            transform: translateX(26px);
        }

        .toggle-switch:hover {
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .toggle-label {
            font-weight: 600;
            color: #555;
            margin: 0;
            user-select: none;
            cursor: pointer;
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="config-panel">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px;">
                <h1 style="color: #333; margin: 0;">Mobile App Demo Generator</h1>
                <div style="display: flex; gap: 12px; align-items: center;">
                    <button onclick="shareConfiguration()"
                        style="background: #667eea; color: white; border: none; font-size: 14px; cursor: pointer; padding: 8px 16px; border-radius: 6px; transition: background-color 0.2s;">üîó
                        Share Configuration</button>
                    <button onclick="showAboutModal()"
                        style="background: none; border: none; color: #667eea; font-size: 14px; cursor: pointer; text-decoration: underline; padding: 8px 12px; border-radius: 6px; transition: background-color 0.2s;">‚ÑπÔ∏è
                        About this Tool</button>
                </div>
            </div>

            <!-- Industry Selection -->
            <div class="section">
                <div class="section-title">1. Choose Your Industry or Upload Your Screenshot</div>
                <div class="industry-templates">
                    <div class="template-card" data-industry="banking">
                        <div class="template-icon">üè¶</div>
                        <div class="template-name">Banking/FinTech</div>
                        <div class="template-desc">Loan applications, document uploads, calculators</div>
                    </div>
                    <div class="template-card" data-industry="retail">
                        <div class="template-icon">üõçÔ∏è</div>
                        <div class="template-name">Retail</div>
                        <div class="template-desc">Shopping cart, order tracking, product browsing</div>
                    </div>
                    <div class="template-card" data-industry="gaming">
                        <div class="template-icon">üéÆ</div>
                        <div class="template-name">Gaming</div>
                        <div class="template-desc">Level progress, achievements, in-app purchases</div>
                    </div>
                    <div class="template-card" data-industry="healthcare">
                        <div class="template-icon">üè•</div>
                        <div class="template-name">Healthcare</div>
                        <div class="template-desc">Medical records, appointments, prescriptions</div>
                    </div>
                    <div class="template-card" data-industry="hotel">
                        <div class="template-icon">üè®</div>
                        <div class="template-name">Hotel</div>
                        <div class="template-desc">Concierge services, room bookings, luxury amenities</div>
                    </div>
                    <div class="template-card" data-industry="custom">
                        <div class="template-icon">‚öôÔ∏è</div>
                        <div class="template-name">Custom</div>
                        <div class="template-desc">Build from scratch</div>
                    </div>
                    <div class="template-card" data-industry="screenshot">
                        <div class="template-icon">üì±</div>
                        <div class="template-name">Upload Your Screenshot</div>
                        <div class="template-desc">Use your own app screenshot for the most realistic demo</div>
                    </div>
                </div>
            </div>

            <!-- App Screenshot Upload (shown only when screenshot option is selected) -->
            <div class="section" id="screenshotSection" style="display: none;">
                <div class="section-title">2. Upload Your App Screenshot</div>
                <div class="form-group">
                    <label for="appScreenshotUrl">App Screenshot URL</label>
                    <div class="url-input-container">
                        <input type="url" id="appScreenshotUrl" name="appScreenshotUrl" autocomplete="url"
                            placeholder="https://example.com/your-app-screenshot.jpg" value="">
                        <div id="urlHistoryDropdown" class="url-history-dropdown" style="display: none;">
                            <!-- Recent URLs will be populated here -->
                        </div>
                    </div>
                    <div style="margin-top: 8px; font-size: 12px; color: #666;">
                        üí° <strong>Tip:</strong> Use a direct image URL (ends with .jpg, .png, .webp)
                    </div>
                </div>

                <div class="form-group">
                    <label for="screenshotUserName">Status Bar Text</label>
                    <input type="text" id="screenshotUserName" placeholder="Enter status bar text"
                        value="Sample App Name">
                    <div style="margin-top: 8px; font-size: 12px; color: #666;">
                        üí° <strong>Tip:</strong> This name will appear in the status bar overlay
                    </div>
                </div>

                <!-- Image Preview -->
                <div class="form-group" id="imagePreviewContainer" style="display: none;">
                    <label>Image Preview</label>
                    <div class="image-preview-container">
                        <img id="imagePreview" class="image-preview" alt="App screenshot preview">
                    </div>
                    <div class="image-size-info">
                        <span><strong>Current size:</strong> <span id="imageSize" class="current-size">-</span></span>
                        <span class="recommended-size"><strong>Recommended:</strong> 375√ó812px (iPhone) or 360√ó720px
                            (Android)</span>
                    </div>
                </div>

                <!-- Helpful Tips -->
                <div
                    style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-top: 15px; border-left: 4px solid #667eea;">
                    <div style="font-size: 12px; color: #666; margin-bottom: 8px;">üì± <strong>Helpful Tips:</strong>
                    </div>
                    <div style="font-size: 12px; color: #666; line-height: 1.4;">
                        <ul style="margin: 0; padding-left: 20px;">
                            <li><strong>Take a screenshot</strong> of your actual mobile app for the most realistic demo
                            </li>
                            <li><strong>Recommended size:</strong> 375√ó812px (iPhone) or 360√ó720px (Android)</li>
                            <li><strong>Image format:</strong> JPG, PNG, or WebP for best performance</li>
                            <li><strong>Upload to:</strong> Imgur, Google Drive (public link), or your own server</li>
                            <li><strong>Privacy:</strong> Only use images you have permission to share publicly</li>
                        </ul>
                        <div
                            style="margin-top: 10px; padding: 8px; background: #e3f2fd; border-radius: 4px; border-left: 3px solid #2196f3;">
                            <strong>Quick Test:</strong> Try this sample URL to see how it works:<br>
                            <code style="font-size: 11px; color: #1976d2; cursor: pointer;"
                                onclick="testSampleImage()">https://example.com/sample-app-screenshot.png</code>
                        </div>
                    </div>
                    <button type="button" onclick="clearAppScreenshot()"
                        style="background: #667eea; color: white; border: none; padding: 8px 16px; border-radius: 6px; font-size: 12px; font-weight: 600; cursor: pointer; margin-top: 10px;">
                        üóëÔ∏è Clear Screenshot
                    </button>
                </div>
            </div>

            <!-- Company Information -->
            <div class="section" id="companyInfoSection">
                <div class="section-title">2. Company Information</div>
                <div class="form-group">
                    <label for="companyName">Company Name *</label>
                    <input type="text" id="companyName" placeholder="Enter your company name" value="Nexus Bank">
                </div>
                <div class="form-group">
                    <label for="companyTagline">Company Tagline</label>
                    <input type="text" id="companyTagline" placeholder="Enter your company tagline"
                        value="Your Path to Homeownership">
                </div>
            </div>

            <!-- Brand Colors -->
            <div class="section" id="brandColorsSection">
                <div class="section-title">3. Brand Colors</div>
                <div class="form-group">
                    <label>Primary Color</label>
                    <div class="color-picker">
                        <input type="color" id="primaryColor" class="color-input" value="#1a365d">
                        <input type="text" id="primaryColorText" value="#1a365d" placeholder="#1a365d">
                    </div>
                </div>
                <div class="form-group">
                    <label>Secondary Color</label>
                    <div class="color-picker">
                        <input type="color" id="secondaryColor" class="color-input" value="#2d5aa0">
                        <input type="text" id="secondaryColorText" value="#2d5aa0" placeholder="#2d5aa0">
                    </div>
                </div>
                <div class="form-group">
                    <label>Accent Color</label>
                    <div class="color-picker">
                        <input type="color" id="accentColor" class="color-input" value="#4299e1">
                        <input type="text" id="accentColorText" value="#4299e1" placeholder="#4299e1">
                    </div>
                </div>
            </div>

            <!-- User Information -->
            <div class="section" id="userInfoSection">
                <div class="section-title">4. User Information</div>
                <div class="form-group">
                    <label for="userFirstName">User First Name *</label>
                    <input type="text" id="userFirstName" placeholder="Enter user's first name" value="Daisy">
                </div>
                <div class="form-group">
                    <label for="userLastName">User Last Name</label>
                    <input type="text" id="userLastName" placeholder="Enter user's last name" value="Johnson">
                </div>
                <div class="form-group">
                    <label for="userEmail">User Email</label>
                    <input type="email" id="userEmail" placeholder="user@example.com" value="daisy.johnson@example.com">
                </div>
                <div class="form-group">
                    <label for="applicationProgress">Progress Indicator (%)</label>
                    <input type="number" id="applicationProgress" min="0" max="100" value="65">
                </div>
                <div class="form-group">
                    <label for="applicationStage">Current Stage</label>
                    <input type="text" id="applicationStage" placeholder="e.g., Document Review"
                        value="Document Review">
                </div>
            </div>

            <!-- Messaging Details -->
            <div class="section" id="messagingSection">
                <div class="section-title" id="messagingSectionTitle">5. Messaging Details</div>
                <div class="form-group">
                    <label for="integrationId">
                        Integration ID *
                        <a href="https://support.zendesk.com/hc/en-us/articles/8357757769114-Getting-a-list-of-integration-IDs-from-messaging-without-connecting-to-AI-agents-Advanced"
                            target="_blank"
                            style="color: #667eea; font-size: 12px; text-decoration: underline; margin-left: 8px;">(What's
                            this?)</a>
                    </label>
                    <div style="position: relative;">
                        <div class="url-input-container">
                            <input type="text" id="integrationId" placeholder="e.g., 68124ef7dc2c6664100ff708"
                                autocomplete="on">
                            <div id="integrationIdHistoryDropdown" class="url-history-dropdown" style="display: none;">
                                <!-- Recent Integration IDs will be populated here -->
                            </div>
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label for="businessName">Business Name (for chat)</label>
                    <input type="text" id="businessName" placeholder="Name shown in chat" value="ZenCX">
                </div>
                <div class="form-group">
                    <label for="businessIconUrl">Business Icon URL</label>
                    <input type="url" id="businessIconUrl" placeholder="https://example.com/icon.jpg"
                        value="https://t3.ftcdn.net/jpg/05/83/74/28/360_F_583742881_HNQwJVxhKDQ7M5LOdBQIYOGDHTOhfZva.jpg">
                </div>
            </div>

            <!-- User Authentication for Messaging -->
            <div class="section" id="userAuthSection">
                <div class="section-title">6. User Authentication for Messaging</div>
                <div
                    style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 20px; border-left: 4px solid #667eea;">
                    <div style="font-size: 12px; color: #666; margin-bottom: 8px;">üîê <strong>About User
                            Authentication:</strong></div>
                    <div style="font-size: 12px; color: #666; line-height: 1.4; margin-bottom: 10px;">
                        Set up JWT authentication to pre-determine who you're signing in as when starting messaging
                        conversations. This allows for personalized chat experiences with user context.
                    </div>
                    <div style="font-size: 12px; color: #666; line-height: 1.4;">
                        <a href="https://support.zendesk.com/hc/en-us/articles/4411666638746-Setting-up-user-authentication-for-messaging"
                            target="_blank" style="color: #667eea; text-decoration: underline;">üìö Learn more about user
                            authentication setup</a>
                    </div>
                </div>
                <div class="form-group">
                    <div class="toggle-container">
                        <label for="enableAuthentication" class="toggle-label">
                            Enable User Authentication (JWT)
                        </label>
                        <div class="toggle-switch" id="toggleSwitch" onclick="toggleAuthentication()">
                            <input type="checkbox" id="enableAuthentication" style="display: none;">
                        </div>
                    </div>
                    <div style="font-size: 12px; color: #666; margin-top: 8px;">
                        When enabled, the demo will use JWT authentication for personalized messaging
                    </div>
                </div>

                <div id="authenticationFields" style="display: none; margin-top: 20px;">
                    <div class="form-group">
                        <label for="jwtSecret">JWT Secret Key *</label>
                        <input type="password" id="jwtSecret" placeholder="Your JWT secret key from Zendesk">
                        <div style="font-size: 12px; color: #666; margin-top: 4px;">
                            Found in Admin Center ‚Üí Channels ‚Üí Messaging and live chat ‚Üí Settings
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="zendeskAppKey">Zendesk App Key (kid) *</label>
                        <input type="text" id="zendeskAppKey" placeholder="app_xxxxxxxxxxxxxxxxxxxxx">
                        <div style="font-size: 12px; color: #666; margin-top: 4px;">
                            Found in Admin Center ‚Üí Account ‚Üí Security ‚Üí End users, in the ID field
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="authUserName">Authenticated User Name</label>
                        <input type="text" id="authUserName" placeholder="e.g., John Doe" value="">
                        <div style="font-size: 12px; color: #666; margin-top: 4px;">
                            The name that will appear in the conversation
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="authUserEmail">Authenticated User Email</label>
                        <input type="email" id="authUserEmail" placeholder="e.g., john@example.com" value="">
                        <div style="font-size: 12px; color: #666; margin-top: 4px;">
                            Email used for user identification
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="authExternalId">External User ID (Optional)</label>
                        <input type="text" id="authExternalId" placeholder="e.g., user_12345" value="">
                        <div style="font-size: 12px; color: #666; margin-top: 4px;">
                            Your system's unique identifier for this user
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="authUserProperties">Additional User Properties (Optional)</label>
                        <textarea id="authUserProperties"
                            placeholder='{"department": "Sales", "tier": "Premium", "account_value": 50000}' rows="3"
                            style="resize: vertical; font-family: 'Courier New', monospace; font-size: 13px;"></textarea>
                        <div style="font-size: 12px; color: #666; margin-top: 4px;">
                            JSON format for custom user attributes that can be used in workflows
                        </div>
                    </div>
                </div>

                <div
                    style="background: #fff3cd; padding: 12px; border-radius: 6px; margin-top: 15px; border-left: 4px solid #ffc107;">
                    <div style="font-size: 12px; color: #856404; margin-bottom: 8px;">
                        <strong>‚ö†Ô∏è Security Note:</strong> JWT secrets should never be exposed in production. This demo
                        tool is for testing purposes only.
                    </div>
                    <div style="font-size: 12px; color: #856404;">
                        <strong>üí° Note:</strong> This demo uses a simplified JWT implementation for demonstration. In
                        production, use proper JWT libraries with server-side token generation.
                    </div>
                </div>
            </div>

            <!-- Push Notification Customization -->
            <div class="section" id="pushNotificationSection">
                <div class="section-title">7. Push Notification Message</div>
                <div class="form-group">
                    <label for="pushNotificationTitle">Notification Title</label>
                    <input type="text" id="pushNotificationTitle" placeholder="Enter notification title" value="">
                </div>
                <div class="form-group">
                    <label for="pushNotificationMessage">Notification Message</label>
                    <textarea id="pushNotificationMessage" placeholder="Enter notification message" rows="3"
                        style="resize: vertical;"></textarea>
                </div>
                <div class="form-group">
                    <label for="pushNotificationIcon">Notification Icon</label>
                    <input type="text" id="pushNotificationIcon" placeholder="Enter emoji or icon" value="">
                </div>
                <div
                    style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-top: 15px; border-left: 4px solid #667eea;">
                    <div style="font-size: 12px; color: #666; margin-bottom: 8px;">üí° <strong>Tip:</strong></div>
                    <div style="font-size: 12px; color: #666; line-height: 1.4;">
                        Leave these fields empty to use industry-specific default messages. Each template comes with
                        appropriate messaging for its industry.
                    </div>
                    <button type="button" onclick="resetPushNotificationDefaults()"
                        style="background: #667eea; color: white; border: none; padding: 8px 16px; border-radius: 6px; font-size: 12px; font-weight: 600; cursor: pointer; margin-top: 10px;">
                        üîÑ Reset to Industry Defaults
                    </button>
                </div>
            </div>


        </div>

        <div class="preview-panel">
            <h3 style="margin-bottom: 20px;">Live Preview</h3>

            <!-- Preview Controls -->
            <div class="preview-controls"
                style="margin-bottom: 20px; padding: 15px; background: #f8f9fa; border-radius: 8px; border: 1px solid #e9ecef;">
                <div style="font-weight: 600; margin-bottom: 10px; color: #495057;">Test Features:</div>
                <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                    <button id="testPushBtn" class="preview-btn" onclick="testPushNotification()">
                        üì± Test Push Notification
                    </button>
                    <button id="testChatBtn" class="preview-btn" onclick="testSunCoChat()">
                        üí¨ Test Chat
                    </button>
                    <button id="resetPreviewBtn" class="preview-btn" onclick="resetPreview()">
                        üîÑ Reset Preview
                    </button>
                    <button id="clearChatsBtn" class="preview-btn" onclick="clearLocalStorage()">
                        üóëÔ∏è Reset All Settings
                    </button>
                </div>
            </div>

            <div class="preview-container">
                <div class="phone-container">
                    <div class="phone-screen" id="previewScreen">
                        <div class="status-bar">
                            <span>9:41</span>
                            <span id="previewCompanyName">Nexus Bank</span>
                            <span>82%</span>
                        </div>

                        <!-- Push Notification in Preview -->
                        <div class="push-notification" id="preview-push-notification">
                            <div class="notification-header">
                                <div class="notification-icon" id="previewNotificationIcon">üè†</div>
                                <div class="notification-app" id="previewNotificationApp">Nexus Bank</div>
                                <div class="notification-time">now</div>
                            </div>
                            <div class="notification-title" id="previewNotificationTitle">Welcome back, Daisy! üëã</div>
                            <div class="notification-message" id="previewNotificationMessage">Continue your document
                                review process</div>
                            <div class="notification-actions">
                                <button class="notification-btn primary" onclick="handleNotificationChatClick()">Learn
                                    More</button>
                                <button class="notification-btn secondary"
                                    onclick="dismissPreviewNotification()">Dismiss</button>
                            </div>
                        </div>

                        <div class="app-header">
                            <div class="logo" id="previewLogo">Nexus Bank</div>
                            <div class="tagline" id="previewTagline">Your Path to Homeownership</div>
                        </div>
                        <div class="main-content" id="previewContent">
                            <div class="welcome-title" id="previewWelcomeTitle">Welcome back, Daisy!</div>
                            <div class="welcome-subtitle" id="previewWelcomeSubtitle">Let's get you closer to your dream
                                home</div>
                            <div class="progress-bar">
                                <div class="progress-fill"></div>
                            </div>
                            <div class="action-grid" id="previewActions">
                                <div class="action-card">
                                    <div class="action-icon">
                                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none"
                                            stroke="currentColor" stroke-width="2">
                                            <rect x="4" y="2" width="16" height="20" rx="2" ry="2" />
                                            <line x1="8" y1="6" x2="16" y2="6" />
                                            <line x1="8" y1="10" x2="16" y2="10" />
                                            <line x1="8" y1="14" x2="16" y2="14" />
                                            <line x1="8" y1="18" x2="12" y2="18" />
                                        </svg>
                                    </div>
                                    <div class="action-title">Loan Calculator</div>
                                    <div class="action-desc">Estimate payments</div>
                                </div>
                                <div class="action-card">
                                    <div class="action-icon">
                                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none"
                                            stroke="currentColor" stroke-width="2">
                                            <path
                                                d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z" />
                                        </svg>
                                    </div>
                                    <div class="action-title">Upload Docs</div>
                                    <div class="action-desc">Submit required files</div>
                                </div>
                                <div class="action-card">
                                    <div class="action-icon">
                                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none"
                                            stroke="currentColor" stroke-width="2">
                                            <polyline points="22,12 18,12 15,21 9,3 6,12 2,12" />
                                        </svg>
                                    </div>
                                    <div class="action-title">Current Rates</div>
                                    <div class="action-desc">View live rates</div>
                                </div>
                                <div class="action-card">
                                    <div class="action-icon">
                                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none"
                                            stroke="currentColor" stroke-width="2">
                                            <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z" />
                                        </svg>
                                    </div>
                                    <div class="action-title">Get Support</div>
                                    <div class="action-desc">Chat with advisor</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Bottom Overlay to Cover Homepage Icons -->
                    <div class="bottom-overlay" id="preview-bottom-overlay"></div>

                    <!-- SunCo Chat Overlay for Preview -->
                    <div class="chat-overlay" id="preview-chat-overlay">
                        <div class="chat-container">
                            <div class="chat-header">
                                <div class="chat-title" id="previewChatTitle">Contact us</div>
                                <button class="chat-close" onclick="closePreviewChat()">√ó</button>
                            </div>
                            <div class="chat-content" id="preview-chat-content">
                                <!-- Real SunCo widget will be loaded here -->
                                <div id="preview-sunco-container" style="height: 100%; width: 100%;"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="notification hidden" id="notification">
                <div class="notification-title">Demo Generated!</div>
                <div class="notification-message">Your mobile app demo has been created successfully.</div>
            </div>
        </div>
    </div>

    <!-- About Modal -->
    <div id="aboutModal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h2>About This Tool</h2>
                <button onclick="hideAboutModal()" class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div style="margin-bottom: 20px;">
                    <h3 style="color: #333; margin-bottom: 10px;">What This Tool Does</h3>
                    <p style="line-height: 1.6; color: #555;">
                        This Mobile App Demo Generator simulates how Zendesk messaging would appear within a mobile app
                        interface.
                        It uses the <strong>embedded web widget</strong> to demonstrate the messaging experience in a
                        mobile context.
                    </p>
                </div>

                <div style="margin-bottom: 20px;">
                    <h3 style="color: #333; margin-bottom: 10px;">Embedded Web Widget vs Mobile SDK</h3>
                    <div
                        style="background: #f8f9fa; padding: 15px; border-radius: 8px; border-left: 4px solid #667eea;">
                        <h4 style="margin-bottom: 10px; color: #495057;">This Demo (Embedded Web Widget):</h4>
                        <ul style="margin: 0; padding-left: 20px; color: #555;">
                            <li>Web-based widget embedded in mobile app</li>
                            <li>Uses web technologies (HTML/CSS/JavaScript)</li>
                            <li>Easier to implement and customize</li>
                            <li>Requires internet connection</li>
                            <li>Limited to web widget capabilities</li>
                        </ul>
                    </div>

                    <div
                        style="background: #fff3cd; padding: 15px; border-radius: 8px; border-left: 4px solid #ffc107; margin-top: 15px;">
                        <h4 style="margin-bottom: 10px; color: #856404;">Native Mobile SDK (Recommended for Production):
                        </h4>
                        <ul style="margin: 0; padding-left: 20px; color: #856404;">
                            <li>Native iOS/Android SDK integration</li>
                            <li>Better performance and native feel</li>
                            <li>Push notifications support</li>
                            <li>Offline capabilities</li>
                            <li>Access to device features</li>
                            <li>Better security and authentication</li>
                        </ul>
                    </div>
                </div>

                <div style="margin-bottom: 20px;">
                    <h3 style="color: #333; margin-bottom: 10px;">Key Differences</h3>
                    <table style="width: 100%; border-collapse: collapse; font-size: 14px;">
                        <thead>
                            <tr style="background: #f8f9fa;">
                                <th style="padding: 10px; text-align: left; border: 1px solid #dee2e6;">Feature</th>
                                <th style="padding: 10px; text-align: left; border: 1px solid #dee2e6;">Web Widget</th>
                                <th style="padding: 10px; text-align: left; border: 1px solid #dee2e6;">Mobile SDK</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td style="padding: 10px; border: 1px solid #dee2e6;"><strong>Push
                                        Notifications</strong></td>
                                <td style="padding: 10px; border: 1px solid #dee2e6;">‚ùå Limited</td>
                                <td style="padding: 10px; border: 1px solid #dee2e6;">‚úÖ Full Support</td>
                            </tr>
                            <tr style="background: #f8f9fa;">
                                <td style="padding: 10px; border: 1px solid #dee2e6;"><strong>Offline Mode</strong></td>
                                <td style="padding: 10px; border: 1px solid #dee2e6;">‚ùå No</td>
                                <td style="padding: 10px; border: 1px solid #dee2e6;">‚úÖ Yes</td>
                            </tr>
                            <tr>
                                <td style="padding: 10px; border: 1px solid #dee2e6;"><strong>Native
                                        Performance</strong></td>
                                <td style="padding: 10px; border: 1px solid #dee2e6;">‚ö†Ô∏è Web-based</td>
                                <td style="padding: 10px; border: 1px solid #dee2e6;">‚úÖ Native</td>
                            </tr>
                            <tr style="background: #f8f9fa;">
                                <td style="padding: 10px; border: 1px solid #dee2e6;"><strong>Device
                                        Integration</strong></td>
                                <td style="padding: 10px; border: 1px solid #dee2e6;">‚ùå Limited</td>
                                <td style="padding: 10px; border: 1px solid #dee2e6;">‚úÖ Full Access</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <div style="background: #e3f2fd; padding: 15px; border-radius: 8px; border-left: 4px solid #2196f3;">
                    <h4 style="margin-bottom: 10px; color: #1976d2;">Learn More</h4>
                    <p style="margin: 0; color: #1976d2; font-size: 14px;">
                        For production mobile apps, we recommend using the native SDKs. Learn more about the
                        <a href="https://github.com/zendesk/messaging_sdk_ios" target="_blank"
                            style="color: #1976d2; text-decoration: underline;">iOS SDK</a> and
                        <a href="https://support.zendesk.com/hc/en-us/articles/4408834810394-Working-with-messaging-for-your-mobile-channel"
                            target="_blank" style="color: #1976d2; text-decoration: underline;">mobile messaging
                            setup</a>.
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- Floating Launch Demo Button -->
    <div class="floating-launch-btn-container">
        <button class="floating-launch-btn" onclick="launchDemo()">üöÄ Launch Demo</button>
    </div>

    <!-- Demo Mode Overlay -->
    <div class="demo-mode" id="demoMode">
        <div class="demo-phone-container">
            <div class="demo-phone-screen" id="demoPhoneScreen">
                <!-- Demo phone content will be cloned here -->
            </div>
        </div>

        <!-- Floating Demo Controls -->
        <div class="demo-controls" id="demoControls">
            <button class="demo-toggle-btn" onclick="toggleDemoControls()" title="Toggle Demo Controls">‚öôÔ∏è</button>
            <div class="demo-controls-header">
                <button class="demo-exit-btn" onclick="exitDemo()">Exit Demo</button>
            </div>
            <div class="demo-controls-buttons">
                <button class="demo-control-btn" onclick="demoTestPushNotification()">
                    üì± Test Push
                </button>
                <button class="demo-control-btn" onclick="demoTestChat()">
                    üí¨ Test Chat
                </button>
                <button class="demo-control-btn" onclick="demoClearChats()">
                    üóëÔ∏è Clear Chats
                </button>
                <div class="device-size-selector">
                    <label for="deviceSize">üì± Device Size:</label>
                    <select id="deviceSize" onchange="changeDeviceSize()">
                        <option value="iphone">iPhone</option>
                        <option value="android">Android</option>
                        <option value="ipad">iPad</option>
                    </select>
                </div>
                <button class="demo-control-btn" onclick="toggleDemoControls()"
                    style="background: linear-gradient(135deg, #6c757d, #5a6268);">
                    üëÅÔ∏è Hide Panel
                </button>
            </div>
        </div>
    </div>

    <!-- Advanced demo generation functions are now integrated into the main file -->

    <script>
        // Industry templates data
        const industryTemplates = {
            banking: {
                name: "Banking/FinTech",
                companyName: "Nexus Bank",
                tagline: "Your Path to Homeownership",
                primaryColor: "#1a365d",
                secondaryColor: "#2d5aa0",
                accentColor: "#4299e1",
                userFirstName: "Daisy",
                userLastName: "Johnson",
                userEmail: "daisy.johnson@example.com",
                businessName: "Nexus Bank Support",
                applicationProgress: 65,
                applicationStage: "Document Review",
                uiLayout: "banking",
                pushNotification: {
                    icon: "üè†",
                    title: "Welcome back, Daisy! üëã",
                    message: "Continue your document review process"
                },
                authentication: {
                    enabled: true,
                    jwtSecret: "", // Add your JWT secret here
                    zendeskAppKey: "", // Add your app key here
                    userName: "Daisy Johnson",
                    userEmail: "daisy.johnson@example.com",
                    externalId: "customer_12345",
                    userProperties: {
                        account_type: "Premium",
                        application_id: "HML_2024_001",
                        loan_amount: 450000,
                        credit_score: 780,
                        department: "Mortgage",
                        priority: "high"
                    }
                }
            },
            retail: {
                name: "Retail",
                companyName: "FashionForward",
                tagline: "Your Style, Your Way",
                primaryColor: "#e91e63",
                secondaryColor: "#f06292",
                accentColor: "#ff4081",
                userFirstName: "Sarah",
                userLastName: "Johnson",
                userEmail: "sarah.johnson@email.com",
                businessName: "FashionForward Customer Care",
                applicationProgress: 45,
                applicationStage: "Order Processing",
                uiLayout: "retail",
                pushNotification: {
                    icon: "üõçÔ∏è",
                    title: "New arrivals, Sarah! üõçÔ∏è",
                    message: "Check out the latest collection"
                },
                authentication: {
                    enabled: true,
                    jwtSecret: "", // Add your JWT secret here
                    zendeskAppKey: "", // Add your app key here
                    userName: "Sarah Johnson",
                    userEmail: "sarah.johnson@email.com",
                    externalId: "shopper_67890",
                    userProperties: {
                        tier: "VIP",
                        loyalty_points: 2500,
                        preferred_size: "M",
                        style_preference: "Casual",
                        total_purchases: 1250
                    }
                }
            },
            gaming: {
                name: "Gaming",
                companyName: "EpicQuest Games",
                tagline: "Adventure Awaits!",
                primaryColor: "#ff6b6b",
                secondaryColor: "#ee5a24",
                accentColor: "#ff9ff3",
                userFirstName: "Alex",
                userLastName: "Chen",
                userEmail: "alex.chen@email.com",
                businessName: "EpicQuest Player Support",
                applicationProgress: 78,
                applicationStage: "Level 45",
                uiLayout: "gaming",
                pushNotification: {
                    icon: "üéÆ",
                    title: "Ready to play, Alex! üéÆ",
                    message: "Continue your adventure at Level 45"
                },
                authentication: {
                    enabled: true,
                    jwtSecret: "", // Add your JWT secret here
                    zendeskAppKey: "", // Add your app key here
                    userName: "Alex Chen",
                    userEmail: "alex.chen@email.com",
                    externalId: "player_alex_2024",
                    userProperties: {
                        player_level: 45,
                        guild: "DragonSlayers",
                        character_class: "Warrior",
                        playtime_hours: 247,
                        premium_member: true,
                        last_login: "2024-11-13"
                    }
                }
            },
            healthcare: {
                name: "Healthcare",
                companyName: "HealthFirst Medical",
                tagline: "Your Health, Our Priority",
                primaryColor: "#48dbfb",
                secondaryColor: "#0abde3",
                accentColor: "#54a0ff",
                userFirstName: "Dr. Johnson",
                userLastName: "Smith",
                userEmail: "dr.johnson@healthfirst.com",
                businessName: "HealthFirst Patient Care",
                applicationProgress: 85,
                applicationStage: "Patient Records",
                uiLayout: "healthcare",
                pushNotification: {
                    icon: "üè•",
                    title: "Health check, Dr. Johnson! üè•",
                    message: "Your wellness journey continues"
                },
                authentication: {
                    enabled: true,
                    jwtSecret: "", // Add your JWT secret here
                    zendeskAppKey: "", // Add your app key here
                    userName: "Dr. Johnson Smith",
                    userEmail: "dr.johnson@healthfirst.com",
                    externalId: "doctor_johnson_001",
                    userProperties: {
                        role: "Doctor",
                        department: "Cardiology",
                        license_number: "MD123456",
                        experience_years: 12,
                        specialization: "Heart Surgery",
                        patient_count: 456
                    }
                }
            },
            hotel: {
                name: "Hotel",
                companyName: "Four Seasons Luxury",
                tagline: "Excellence in Service",
                primaryColor: "#8b4513",
                secondaryColor: "#d2691e",
                accentColor: "#ffd700",
                userFirstName: "Michael",
                userLastName: "Anderson",
                userEmail: "michael.anderson@fourseasons.com",
                businessName: "Four Seasons Concierge",
                applicationProgress: 90,
                applicationStage: "Concierge Services",
                uiLayout: "hotel",
                pushNotification: {
                    icon: "üè®",
                    title: "Welcome, Michael! üè®",
                    message: "Your luxury experience awaits"
                },
                authentication: {
                    enabled: true,
                    jwtSecret: "", // Add your JWT secret here
                    zendeskAppKey: "", // Add your app key here
                    userName: "Michael Anderson",
                    userEmail: "michael.anderson@fourseasons.com",
                    externalId: "guest_anderson_2024",
                    userProperties: {
                        membership_tier: "Diamond",
                        room_number: "1205",
                        check_in: "2024-11-10",
                        check_out: "2024-11-15",
                        total_stays: 28,
                        preferred_room_type: "Ocean View Suite"
                    }
                }
            }
        };

        // Initialize the generator
        document.addEventListener('DOMContentLoaded', function () {
            setupEventListeners();
            updatePreview();

            // Pre-load SunCo library to ensure it's available when needed
            preloadSunCo();

            // Load configuration from URL if present
            loadConfigurationFromUrl();
        });

        function setupEventListeners() {
            // Industry template selection
            document.querySelectorAll('.template-card').forEach(card => {
                card.addEventListener('click', function () {
                    document.querySelectorAll('.template-card').forEach(c => c.classList.remove('selected'));
                    this.classList.add('selected');

                    const industry = this.dataset.industry;
                    const screenshotSection = document.getElementById('screenshotSection');

                    if (industry === 'screenshot') {
                        // Show screenshot section and hide styling sections
                        screenshotSection.style.display = 'block';
                        hideStylingSections();
                        // Clear any existing template data
                        clearTemplateData();
                    } else {
                        // Hide screenshot section and show styling sections
                        screenshotSection.style.display = 'none';
                        showStylingSections();

                        // Clear screenshot when switching away from screenshot mode
                        clearAppScreenshot();

                        if (industry !== 'custom' && industryTemplates[industry]) {
                            loadTemplate(industryTemplates[industry]);
                        } else if (industry === 'custom') {
                            // For custom industry, update business name based on current company name
                            updateBusinessNameFromCompany();
                        }
                    }
                });
            });

            // Color picker synchronization
            ['primary', 'secondary', 'accent'].forEach(colorType => {
                const colorInput = document.getElementById(colorType + 'Color');
                const textInput = document.getElementById(colorType + 'ColorText');

                colorInput.addEventListener('input', function () {
                    textInput.value = this.value;
                    updatePreview();
                });

                textInput.addEventListener('input', function () {
                    colorInput.value = this.value;
                    updatePreview();
                });
            });

            // Real-time preview updates
            ['companyName', 'companyTagline', 'userFirstName', 'userLastName', 'userEmail',
                'integrationId', 'businessName', 'applicationProgress', 'applicationStage',
                'pushNotificationTitle', 'pushNotificationMessage', 'pushNotificationIcon'].forEach(id => {
                    document.getElementById(id).addEventListener('input', updatePreview);
                });

            // Auto-update business name when company name changes
            document.getElementById('companyName').addEventListener('input', function () {
                updateBusinessNameFromCompany();
            });

            // App screenshot URL handling
            document.getElementById('appScreenshotUrl').addEventListener('input', function () {
                handleAppScreenshotUrl(this.value);
            });

            // URL History functionality
            document.getElementById('appScreenshotUrl').addEventListener('focus', function () {
                showUrlHistory();
            });

            document.getElementById('appScreenshotUrl').addEventListener('blur', function () {
                // Delay hiding to allow clicking on dropdown items
                setTimeout(() => {
                    hideUrlHistory();
                }, 200);
            });

            // Screenshot user name handling
            document.getElementById('screenshotUserName').addEventListener('input', function () {
                updatePreview();
            });

            // User authentication toggle
            const enableAuthElement = document.getElementById('enableAuthentication');
            if (enableAuthElement) {
                enableAuthElement.addEventListener('change', function () {
                    toggleAuthenticationFields();
                });
            }

            // Real-time preview updates for authentication fields
            ['authUserName', 'authUserEmail', 'authExternalId', 'authUserProperties', 'jwtSecret', 'zendeskAppKey'].forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.addEventListener('input', updatePreview);
                }
            });
        }

        function loadTemplate(template) {
            document.getElementById('companyName').value = template.companyName;
            document.getElementById('companyTagline').value = template.tagline;
            document.getElementById('userFirstName').value = template.userFirstName;
            document.getElementById('userLastName').value = template.userLastName;
            document.getElementById('userEmail').value = template.userEmail;
            document.getElementById('businessName').value = template.businessName;
            document.getElementById('applicationProgress').value = template.applicationProgress;
            document.getElementById('applicationStage').value = template.applicationStage;

            document.getElementById('primaryColor').value = template.primaryColor;
            document.getElementById('primaryColorText').value = template.primaryColor;
            document.getElementById('secondaryColor').value = template.secondaryColor;
            document.getElementById('secondaryColorText').value = template.secondaryColor;
            document.getElementById('accentColor').value = template.accentColor;
            document.getElementById('accentColorText').value = template.accentColor;

            // Load push notification defaults if available
            if (template.pushNotification) {
                document.getElementById('pushNotificationIcon').value = template.pushNotification.icon;
                document.getElementById('pushNotificationTitle').value = template.pushNotification.title;
                document.getElementById('pushNotificationMessage').value = template.pushNotification.message;
            } else {
                // Clear push notification fields for custom template
                document.getElementById('pushNotificationIcon').value = '';
                document.getElementById('pushNotificationTitle').value = '';
                document.getElementById('pushNotificationMessage').value = '';
            }

            // Load authentication defaults if available
            if (template.authentication) {
                document.getElementById('enableAuthentication').checked = template.authentication.enabled || false;
                document.getElementById('jwtSecret').value = template.authentication.jwtSecret || '';
                document.getElementById('zendeskAppKey').value = template.authentication.zendeskAppKey || '';
                document.getElementById('authUserName').value = template.authentication.userName || '';
                document.getElementById('authUserEmail').value = template.authentication.userEmail || '';
                document.getElementById('authExternalId').value = template.authentication.externalId || '';
                document.getElementById('authUserProperties').value = template.authentication.userProperties ? JSON.stringify(template.authentication.userProperties, null, 2) : '';
                toggleAuthenticationFields();
            } else {
                // Clear authentication fields and disable
                document.getElementById('enableAuthentication').checked = false;
                document.getElementById('jwtSecret').value = '';
                document.getElementById('zendeskAppKey').value = '';
                document.getElementById('authUserName').value = '';
                document.getElementById('authUserEmail').value = '';
                document.getElementById('authExternalId').value = '';
                document.getElementById('authUserProperties').value = '';
                document.getElementById('authenticationFields').style.display = 'none';
            }

            updatePreview();
        }

        function updateBusinessNameFromCompany() {
            const companyName = document.getElementById('companyName').value;
            const industry = getSelectedIndustry();

            if (!companyName) return;

            let businessNameSuffix = '';
            switch (industry) {
                case 'banking':
                    businessNameSuffix = ' Support';
                    break;
                case 'retail':
                    businessNameSuffix = ' Customer Care';
                    break;
                case 'gaming':
                    businessNameSuffix = ' Player Support';
                    break;
                case 'healthcare':
                    businessNameSuffix = ' Patient Care';
                    break;
                case 'hotel':
                    businessNameSuffix = ' Concierge';
                    break;
                default:
                    businessNameSuffix = ' Support';
            }

            document.getElementById('businessName').value = companyName + businessNameSuffix;
        }

        function handleAppScreenshotUrl(url) {
            const imagePreview = document.getElementById('imagePreview');
            const imagePreviewContainer = document.getElementById('imagePreviewContainer');
            const imageSize = document.getElementById('imageSize');
            const urlInput = document.getElementById('appScreenshotUrl');

            if (!url || url.trim() === '') {
                imagePreviewContainer.style.display = 'none';
                urlInput.style.borderColor = '#e1e5e9';
                updatePreview();
                return;
            }

            // Validate URL format
            try {
                new URL(url);
                urlInput.style.borderColor = '#667eea';
            } catch (e) {
                imagePreviewContainer.style.display = 'none';
                urlInput.style.borderColor = '#dc3545';
                updatePreview();
                return;
            }

            // Show loading state
            imageSize.textContent = 'Loading...';
            imagePreviewContainer.style.display = 'block';

            // Load and preview the image
            imagePreview.onload = function () {
                imagePreviewContainer.style.display = 'block';
                imageSize.textContent = `${this.naturalWidth}√ó${this.naturalHeight}px`;

                // Check if image size is optimal
                const width = this.naturalWidth;
                const height = this.naturalHeight;
                const aspectRatio = width / height;

                if (aspectRatio < 0.4 || aspectRatio > 0.6) {
                    imageSize.innerHTML = `${width}√ó${height}px <span style="color: #dc3545;">‚ö†Ô∏è</span>`;
                } else {
                    imageSize.innerHTML = `${width}√ó${height}px <span style="color: #28a745;">‚úì</span>`;
                }

                // Remove any existing error message
                const existingError = imagePreviewContainer.parentNode.querySelector('.error-message');
                if (existingError) existingError.remove();

                // Show success message briefly
                const successMsg = document.createElement('div');
                successMsg.style.cssText = 'color: #28a745; font-size: 12px; margin-top: 8px; padding: 8px; background: #d4edda; border-radius: 4px; border: 1px solid #c3e6cb;';
                successMsg.textContent = '‚úÖ Image loaded successfully!';
                successMsg.className = 'success-message';
                imagePreviewContainer.parentNode.appendChild(successMsg);

                // Remove success message after 3 seconds
                setTimeout(() => {
                    if (successMsg.parentNode) {
                        successMsg.remove();
                    }
                }, 3000);

                // Save URL to history when image loads successfully
                saveUrlToHistory(url);

                updatePreview();
            };

            imagePreview.onerror = function () {
                imagePreviewContainer.style.display = 'none';
                urlInput.style.borderColor = '#dc3545';
                console.error('Failed to load image from URL:', url);

                // Show error message
                const errorMsg = document.createElement('div');
                errorMsg.style.cssText = 'color: #dc3545; font-size: 12px; margin-top: 8px; padding: 8px; background: #f8d7da; border-radius: 4px; border: 1px solid #f5c6cb;';
                errorMsg.textContent = '‚ùå Failed to load image. Please check the URL and try again.';

                // Remove any existing error message
                const existingError = imagePreviewContainer.parentNode.querySelector('.error-message');
                if (existingError) existingError.remove();

                errorMsg.className = 'error-message';
                imagePreviewContainer.parentNode.appendChild(errorMsg);

                updatePreview();
            };

            imagePreview.src = url;
        }

        function clearAppScreenshot() {
            document.getElementById('appScreenshotUrl').value = '';
            document.getElementById('imagePreviewContainer').style.display = 'none';

            // Clear any error or success messages
            const errorMessage = document.querySelector('.error-message');
            if (errorMessage) errorMessage.remove();

            const successMessage = document.querySelector('.success-message');
            if (successMessage) successMessage.remove();

            updatePreview();
        }

        function testSampleImage() {
            const sampleUrl = 'https://github.com/Asa240/mobile-app-demo-generator/blob/main/Mobile_Demo_Generator_v3.0_Clean/mobile_ticket_screen_ios.png?raw=true';
            document.getElementById('appScreenshotUrl').value = sampleUrl;
            handleAppScreenshotUrl(sampleUrl);
        }

        function checkRequiredPreviewElements() {
            const requiredElements = [
                'previewContent',
                'previewScreen',
                'companyName',
                'companyTagline',
                'userFirstName',
                'applicationProgress',
                'applicationStage'
            ];

            for (const elementId of requiredElements) {
                if (!document.getElementById(elementId)) {
                    console.warn(`Required element not found: ${elementId}`);
                    return false;
                }
            }
            return true;
        }

        function updatePreview() {
            // Check if all required DOM elements exist before proceeding
            if (!checkRequiredPreviewElements()) {
                console.warn('Required preview elements not found, skipping update');
                return;
            }

            const selectedIndustry = getSelectedIndustry();

            if (selectedIndustry === 'screenshot') {
                // In screenshot mode, only update the screenshot preview
                updateAppScreenshotInPreview();
                return;
            }

            // For non-screenshot industries, restore the full preview content
            const companyName = document.getElementById('companyName').value || 'Your Company';
            const tagline = document.getElementById('companyTagline').value || 'Your tagline here';
            const userFirstName = document.getElementById('userFirstName').value || 'User';
            const applicationProgress = document.getElementById('applicationProgress').value || 0;
            const applicationStage = document.getElementById('applicationStage').value || 'In Progress';

            // Restore the full preview structure
            const previewContent = document.getElementById('previewContent');
            if (!previewContent) {
                console.warn('previewContent element not found');
                return;
            }

            previewContent.innerHTML = `
                <div class="welcome-title" id="previewWelcomeTitle">Welcome back, ${userFirstName}!</div>
                <div class="welcome-subtitle" id="previewWelcomeSubtitle">Let's get you closer to your dream home</div>
                <div class="progress-bar">
                    <div class="progress-fill"></div>
                </div>
                <div class="action-grid" id="previewActions">
                    <!-- Action cards will be populated by updateUILayout() -->
                </div>
            `;

            const previewCompanyName = document.getElementById('previewCompanyName');
            const previewLogo = document.getElementById('previewLogo');
            const previewTagline = document.getElementById('previewTagline');

            if (previewCompanyName) previewCompanyName.textContent = userFirstName + "'s phone";
            if (previewLogo) previewLogo.textContent = companyName;
            if (previewTagline) previewTagline.textContent = tagline;

            // Update welcome content based on industry
            updateWelcomeContent(userFirstName, applicationStage);

            // Update progress bar
            const progressFill = document.querySelector('#previewContent .progress-fill');
            if (progressFill) {
                progressFill.style.width = `${applicationProgress}%`;
            }

            // Update CSS variables for colors
            const primaryColor = document.getElementById('primaryColor').value;
            const secondaryColor = document.getElementById('secondaryColor').value;
            const accentColor = document.getElementById('accentColor').value;

            document.documentElement.style.setProperty('--primary-color', primaryColor);
            document.documentElement.style.setProperty('--secondary-color', secondaryColor);
            document.documentElement.style.setProperty('--accent-color', accentColor);

            // Update UI layout based on selected industry
            updateUILayout();
        }

        function hideStylingSections() {
            // Hide only styling-related sections when screenshot mode is selected
            // Keep user info, authentication, and push notifications visible as they're still relevant
            const sectionsToHide = [
                'companyInfoSection',
                'brandColorsSection'
            ];

            sectionsToHide.forEach(sectionId => {
                const section = document.getElementById(sectionId);
                if (section) {
                    section.style.display = 'none';
                }
            });

            // Update section numbering for remaining sections
            updateSectionNumbering();
        }

        function showStylingSections() {
            // Show all styling-related sections when other modes are selected
            const sectionsToShow = [
                'companyInfoSection',
                'brandColorsSection',
                'userInfoSection',
                'userAuthSection',
                'pushNotificationSection'
            ];

            sectionsToShow.forEach(sectionId => {
                const section = document.getElementById(sectionId);
                if (section) {
                    section.style.display = 'block';
                }
            });

            // Update section numbering for all sections
            updateSectionNumbering();
        }

        function updateSectionNumbering() {
            const selectedIndustry = getSelectedIndustry();

            if (selectedIndustry === 'screenshot') {
                // In screenshot mode, sections are: 1. Industry, 2. Screenshot, 3. User Info, 4. Messaging, 5. Authentication, 6. Push Notifications
                const messagingSectionTitle = document.getElementById('messagingSectionTitle');
                if (messagingSectionTitle) {
                    messagingSectionTitle.textContent = '4. Messaging Details';
                }

                // Update other section titles that remain visible
                const userInfoSection = document.querySelector('#userInfoSection .section-title');
                if (userInfoSection) {
                    userInfoSection.textContent = '3. User Information';
                }

                const userAuthSection = document.querySelector('#userAuthSection .section-title');
                if (userAuthSection) {
                    userAuthSection.textContent = '5. User Authentication for Messaging';
                }

                const pushNotificationSection = document.querySelector('#pushNotificationSection .section-title');
                if (pushNotificationSection) {
                    pushNotificationSection.textContent = '6. Push Notification Message';
                }
            } else {
                // In other modes, all sections are visible with original numbering
                const messagingSectionTitle = document.getElementById('messagingSectionTitle');
                if (messagingSectionTitle) {
                    messagingSectionTitle.textContent = '5. Messaging Details';
                }

                // Reset other section titles to original numbering
                const userInfoSection = document.querySelector('#userInfoSection .section-title');
                if (userInfoSection) {
                    userInfoSection.textContent = '4. User Information';
                }

                const userAuthSection = document.querySelector('#userAuthSection .section-title');
                if (userAuthSection) {
                    userAuthSection.textContent = '6. User Authentication for Messaging';
                }

                const pushNotificationSection = document.querySelector('#pushNotificationSection .section-title');
                if (pushNotificationSection) {
                    pushNotificationSection.textContent = '7. Push Notification Message';
                }
            }
        }

        function clearTemplateData() {
            // Clear form fields when switching to screenshot mode
            document.getElementById('companyName').value = '';
            document.getElementById('companyTagline').value = '';
            document.getElementById('userFirstName').value = '';
            document.getElementById('userLastName').value = '';
            document.getElementById('applicationProgress').value = '0';
            document.getElementById('applicationStage').value = '';
            document.getElementById('pushNotificationIcon').value = '';
            document.getElementById('pushNotificationTitle').value = '';
            document.getElementById('pushNotificationMessage').value = '';

            // Clear authentication fields
            document.getElementById('enableAuthentication').checked = false;
            document.getElementById('jwtSecret').value = '';
            document.getElementById('zendeskAppKey').value = '';
            document.getElementById('authUserName').value = '';
            document.getElementById('authUserEmail').value = '';
            document.getElementById('authExternalId').value = '';
            document.getElementById('authUserProperties').value = '';
            document.getElementById('authenticationFields').style.display = 'none';

            // Reset colors to defaults
            document.getElementById('primaryColor').value = '#1a365d';
            document.getElementById('primaryColorText').value = '#1a365d';
            document.getElementById('secondaryColor').value = '#2d5aa0';
            document.getElementById('secondaryColorText').value = '#2d5aa0';
            document.getElementById('accentColor').value = '#4299e1';
            document.getElementById('accentColorText').value = '#4299e1';

            updatePreview();
        }

        function toggleAuthenticationFields() {
            const enableAuthElement = document.getElementById('enableAuthentication');
            const authFields = document.getElementById('authenticationFields');

            if (!enableAuthElement || !authFields) {
                console.warn('Authentication form elements not found');
                return;
            }

            const enableAuth = enableAuthElement.checked;

            if (enableAuth) {
                authFields.style.display = 'block';
                // Pre-populate with user info if available
                populateAuthFieldsFromUserInfo();
            } else {
                authFields.style.display = 'none';
            }

            updatePreview();
        }

        function populateAuthFieldsFromUserInfo() {
            const userFirstNameEl = document.getElementById('userFirstName');
            const userLastNameEl = document.getElementById('userLastName');
            const userEmailEl = document.getElementById('userEmail');
            const authUserNameEl = document.getElementById('authUserName');
            const authUserEmailEl = document.getElementById('authUserEmail');

            if (!userFirstNameEl || !userLastNameEl || !userEmailEl || !authUserNameEl || !authUserEmailEl) {
                console.warn('Some user info elements not found for auth population');
                return;
            }

            const userFirstName = userFirstNameEl.value;
            const userLastName = userLastNameEl.value;
            const userEmail = userEmailEl.value;

            if (userFirstName || userLastName) {
                const fullName = [userFirstName, userLastName].filter(Boolean).join(' ');
                if (fullName && !authUserNameEl.value) {
                    authUserNameEl.value = fullName;
                }
            }

            if (userEmail && !authUserEmailEl.value) {
                authUserEmailEl.value = userEmail;
            }
        }

        // Toggle Authentication Function
        function toggleAuthentication() {
            const checkbox = document.getElementById('enableAuthentication');
            const toggleSwitch = document.getElementById('toggleSwitch');

            if (!checkbox || !toggleSwitch) {
                console.warn('Authentication toggle elements not found');
                return;
            }

            checkbox.checked = !checkbox.checked;

            if (checkbox.checked) {
                toggleSwitch.classList.add('active');
            } else {
                toggleSwitch.classList.remove('active');
            }

            toggleAuthenticationFields();
        }

        // JWT Helper Functions for proper HMAC-SHA256 signing
        async function generateProperJWTToken() {
            const jwtSecret = document.getElementById('jwtSecret').value;
            const zendeskAppKey = document.getElementById('zendeskAppKey').value;
            const userName = document.getElementById('authUserName').value;
            const userEmail = document.getElementById('authUserEmail').value;
            const externalId = document.getElementById('authExternalId').value;
            const userPropsText = document.getElementById('authUserProperties').value;

            if (!jwtSecret || !zendeskAppKey || !userEmail) {
                console.warn('JWT Secret, Zendesk App Key, and User Email are required for authentication');
                return null;
            }

            try {
                // Parse user properties
                let userProperties = {};
                if (userPropsText && userPropsText.trim() !== '') {
                    userProperties = JSON.parse(userPropsText);
                }

                const header = { alg: 'HS256', typ: 'JWT', kid: zendeskAppKey };
                const payload = {
                    scope: 'user',
                    name: userName,
                    iat: Math.floor(Date.now() / 1000),
                    exp: Math.floor(Date.now() / 1000) + (60 * 60), // 1 hour expiration
                    email: userEmail
                    // ...userProperties
                };

                if (externalId) {
                    payload.external_id = externalId;
                }

                console.log(`Header: ${JSON.stringify(header)}\nPayload: ${JSON.stringify(payload)}`);

                // Proper JWT creation with real HMAC-SHA256 signature
                const encodedHeader = base64UrlEncode(JSON.stringify(header));
                const encodedPayload = base64UrlEncode(JSON.stringify(payload));

                // Create the signature using HMAC-SHA256
                const signature = await createHMACSHA256Signature(
                    encodedHeader + '.' + encodedPayload,
                    jwtSecret
                );

                const jwt = `${encodedHeader}.${encodedPayload}.${signature}`;
                console.log('‚úÖ Generated properly signed JWT token');
                console.log('Header:', header);
                console.log('Payload:', payload);

                return jwt;

            } catch (error) {
                console.error('Error generating JWT:', error);
                return null;
            }
        }

        // Base64 URL-safe encoding (different from regular base64)
        function base64UrlEncode(str) {
            return btoa(str)
                .replace(/\+/g, '-')
                .replace(/\//g, '_')
                .replace(/=/g, '');
        }

        // Create HMAC-SHA256 signature using Web Crypto API
        async function createHMACSHA256Signature(data, secret) {
            const encoder = new TextEncoder();
            const key = await crypto.subtle.importKey(
                'raw',
                encoder.encode(secret),
                { name: 'HMAC', hash: 'SHA-256' },
                false,
                ['sign']
            );

            const signature = await crypto.subtle.sign('HMAC', key, encoder.encode(data));
            const signatureArray = new Uint8Array(signature);

            // Convert to base64 URL-safe
            return base64UrlEncode(String.fromCharCode(...signatureArray));
        }

        // Legacy function for backward compatibility - now calls the proper implementation
        function generateJWTToken() {
            // Since we need async for crypto operations, return a Promise
            return generateProperJWTToken();
        }

        function getAuthenticationConfig() {
            const enableAuth = document.getElementById('enableAuthentication').checked;

            if (!enableAuth) {
                return null;
            }

            const userName = document.getElementById('authUserName').value;
            const userEmail = document.getElementById('authUserEmail').value;
            const externalId = document.getElementById('authExternalId').value;
            const userPropsText = document.getElementById('authUserProperties').value;

            if (!userEmail) {
                console.warn('User Email is required for authentication');
                return null;
            }

            let userProperties = {};
            try {
                if (userPropsText && userPropsText.trim() !== '') {
                    userProperties = JSON.parse(userPropsText);
                }
            } catch (error) {
                console.error('Invalid JSON in user properties:', error);
                return null;
            }

            return {
                enabled: true,
                userName: userName,
                userEmail: userEmail,
                externalId: externalId,
                userProperties: userProperties
            };
        }

        function updateAppScreenshotInPreview() {
            const appScreenshotUrl = document.getElementById('appScreenshotUrl').value;
            const mainContent = document.getElementById('previewContent');
            const selectedIndustry = getSelectedIndustry();

            if (!mainContent) {
                console.warn('previewContent element not found in updateAppScreenshotInPreview');
                return;
            }

            if (selectedIndustry === 'screenshot') {
                // Always show screenshot if screenshot industry is selected
                if (appScreenshotUrl && appScreenshotUrl.trim() !== '') {
                    showCustomAppScreenshot(appScreenshotUrl);
                } else {
                    // Show placeholder for screenshot mode
                    showScreenshotPlaceholder();
                }
                return;
            }

            // For non-screenshot industries, don't show any screenshot
            // Just show the default content for the selected industry
            showDefaultContent();
        }

        function showDefaultContent() {
            const mainContent = document.getElementById('previewContent');
            const selectedIndustry = getSelectedIndustry();

            if (!mainContent) {
                console.warn('previewContent element not found in showDefaultContent');
                return;
            }

            // Only show default content if we're not in screenshot mode
            if (selectedIndustry === 'screenshot') {
                return; // Don't show default content for screenshot mode
            }

            // Restore default content structure
            mainContent.innerHTML = `
                <div class="welcome-title" id="previewWelcomeTitle">Welcome back, ${document.getElementById('userFirstName').value || 'User'}!</div>
                <div class="welcome-subtitle" id="previewWelcomeSubtitle">Let's get you closer to your dream home</div>
                <div class="progress-bar">
                    <div class="progress-fill"></div>
                </div>
                <div class="action-grid" id="previewActions">
                    <!-- Action cards will be populated by updateUILayout() -->
                </div>
            `;

            // Update UI layout to populate action cards
            updateUILayout();
        }

        function showCustomAppScreenshot(imageUrl) {
            const phoneScreen = document.getElementById('previewScreen');

            if (!phoneScreen) {
                console.warn('previewScreen element not found in showCustomAppScreenshot');
                return;
            }

            const userName = document.getElementById('screenshotUserName').value || 'Sample App Name';

            // Replace phone screen content with screenshot and overlay status bar
            phoneScreen.innerHTML = `
                <div style="width: 100%; height: 100%; position: relative; overflow: hidden;">
                    <img src="${imageUrl}" alt="Custom app screenshot" style="width: 100%; height: 100%; object-fit: cover; border-radius: 0; box-shadow: none;">
                    <div class="status-bar" style="position: absolute; top: 0; left: 0; right: 0; z-index: 10;">
                        <span>9:41</span>
                        <span>${userName}</span>
                        <span>82%</span>
                    </div>
                </div>
            `;

            // Re-add the push notification and chat overlays with higher z-index
            addOverlaysToScreenshot();
        }

        function addOverlaysToScreenshot() {
            const phoneScreen = document.getElementById('previewScreen');

            if (!phoneScreen) {
                console.warn('previewScreen element not found in addOverlaysToScreenshot');
                return;
            }

            // Add push notification overlay
            const pushNotification = document.createElement('div');
            pushNotification.className = 'push-notification';
            pushNotification.id = 'preview-push-notification';
            pushNotification.innerHTML = `
                <div class="notification-header">
                    <div class="notification-icon" id="previewNotificationIcon">üè†</div>
                    <div class="notification-app" id="previewNotificationApp">Your App</div>
                    <div class="notification-time">now</div>
                </div>
                <div class="notification-title" id="previewNotificationTitle">Welcome back! üëã</div>
                <div class="notification-message" id="previewNotificationMessage">Your app is ready</div>
                <div class="notification-actions">
                    <button class="notification-btn primary" onclick="handleNotificationChatClick()">Learn More</button>
                    <button class="notification-btn secondary" onclick="dismissPreviewNotification()">Dismiss</button>
                </div>
            `;
            phoneScreen.appendChild(pushNotification);

            // Add chat overlay
            const chatOverlay = document.createElement('div');
            chatOverlay.className = 'chat-overlay screenshot-mode';
            chatOverlay.id = 'preview-chat-overlay';
            chatOverlay.innerHTML = `
                <div class="chat-container">
                    <div class="chat-header">
                        <div class="chat-title" id="previewChatTitle">Contact us</div>
                        <button class="chat-close" onclick="closePreviewChat()">√ó</button>
                    </div>
                    <div class="chat-content" id="preview-chat-content">
                        <div id="preview-sunco-container" style="height: 100%; width: 100%;"></div>
                    </div>
                </div>
            `;
            phoneScreen.appendChild(chatOverlay);

            // Add bottom overlay
            const bottomOverlay = document.createElement('div');
            bottomOverlay.className = 'bottom-overlay';
            bottomOverlay.id = 'preview-bottom-overlay';
            phoneScreen.appendChild(bottomOverlay);
        }

        function addDemoOverlaysToScreenshot() {
            const demoPhoneScreen = document.getElementById('demoPhoneScreen');

            if (!demoPhoneScreen) {
                console.warn('demoPhoneScreen element not found in addDemoOverlaysToScreenshot');
                return;
            }

            // Add push notification overlay
            const pushNotification = document.createElement('div');
            pushNotification.className = 'push-notification';
            pushNotification.innerHTML = `
                <div class="notification-header">
                    <div class="notification-icon">üè†</div>
                    <div class="notification-app">Your App</div>
                    <div class="notification-time">now</div>
                </div>
                <div class="notification-title">Welcome back! üëã</div>
                <div class="notification-message">Your app is ready</div>
                <div class="notification-actions">
                    <button class="notification-btn primary" onclick="handleNotificationChatClick()">Learn More</button>
                    <button class="notification-btn secondary" onclick="dismissPreviewNotification()">Dismiss</button>
                </div>
            `;
            demoPhoneScreen.appendChild(pushNotification);

            // Add chat overlay
            const chatOverlay = document.createElement('div');
            chatOverlay.className = 'chat-overlay screenshot-mode';
            chatOverlay.innerHTML = `
                <div class="chat-container">
                    <div class="chat-header">
                        <div class="chat-title">Contact us</div>
                        <button class="chat-close" onclick="closeDemoChat()">√ó</button>
                    </div>
                    <div class="chat-content">
                        <div id="demo-sunco-container" style="height: 100%; width: 100%;"></div>
                    </div>
                </div>
            `;
            demoPhoneScreen.appendChild(chatOverlay);

            // Add bottom overlay
            const bottomOverlay = document.createElement('div');
            bottomOverlay.className = 'bottom-overlay';
            demoPhoneScreen.appendChild(bottomOverlay);
        }

        function showScreenshotPlaceholder() {
            const mainContent = document.getElementById('previewContent');

            if (!mainContent) {
                console.warn('previewContent element not found in showScreenshotPlaceholder');
                return;
            }

            const userName = document.getElementById('screenshotUserName').value || 'Sample App Name';

            // Show placeholder for screenshot mode with status bar
            mainContent.innerHTML = `
                <div style="width: 100%; height: 100%; position: relative; background: #f8f9fa; border-radius: 8px; border: 2px dashed #dee2e6;">
                    <div class="status-bar" style="position: absolute; top: 0; left: 0; right: 0; z-index: 10;">
                        <span>9:41</span>
                        <span>${userName}</span>
                        <span>82%</span>
                    </div>
                    <div style="width: 100%; height: 100%; display: flex; flex-direction: column; align-items: center; justify-content: center; padding-top: 44px;">
                        <div style="font-size: 48px; margin-bottom: 16px; opacity: 0.5;">üì±</div>
                        <div style="font-size: 18px; font-weight: 600; color: #495057; margin-bottom: 8px; text-align: center;">Upload Your App Screenshot</div>
                        <div style="font-size: 14px; color: #6c757d; text-align: center; line-height: 1.4;">
                            Enter an image URL above to see your app<br>screenshot in the preview
                        </div>
                    </div>
                </div>
            `;
        }

        function getConfig() {
            const selectedIndustry = getSelectedIndustry();

            const config = {
                industry: selectedIndustry,
                sunco: {
                    integrationId: document.getElementById('integrationId').value,
                    businessName: document.getElementById('businessName').value
                },
                appScreenshot: {
                    url: document.getElementById('appScreenshotUrl').value
                }
            };

            if (selectedIndustry !== 'screenshot') {
                // Only include styling config for non-screenshot modes
                config.company = {
                    name: document.getElementById('companyName').value,
                    tagline: document.getElementById('companyTagline').value
                };
                config.colors = {
                    primary: document.getElementById('primaryColor').value,
                    secondary: document.getElementById('secondaryColor').value,
                    accent: document.getElementById('accentColor').value
                };
                config.user = {
                    firstName: document.getElementById('userFirstName').value,
                    lastName: document.getElementById('userLastName').value,
                    email: document.getElementById('userEmail').value
                };
                config.application = {
                    progress: document.getElementById('applicationProgress').value,
                    stage: document.getElementById('applicationStage').value
                };
                config.pushNotification = {
                    icon: document.getElementById('pushNotificationIcon').value,
                    title: document.getElementById('pushNotificationTitle').value,
                    message: document.getElementById('pushNotificationMessage').value
                };
            }

            return config;
        }

        function getSelectedIndustry() {
            const selectedCard = document.querySelector('.template-card.selected');
            return selectedCard ? selectedCard.dataset.industry : 'custom';
        }

        function updateUILayout() {
            const industry = getSelectedIndustry();
            const actionGrid = document.getElementById('previewActions');

            if (!actionGrid) return;

            // Clear existing actions
            actionGrid.innerHTML = '';

            switch (industry) {
                case 'banking':
                    updateBankingLayout(actionGrid);
                    break;
                case 'retail':
                    updateRetailLayout(actionGrid);
                    break;
                case 'gaming':
                    updateGamingLayout(actionGrid);
                    break;
                case 'healthcare':
                    updateHealthcareLayout(actionGrid);
                    break;
                case 'hotel':
                    updateHotelLayout(actionGrid);
                    break;
                default:
                    updateBankingLayout(actionGrid); // Default to banking layout
            }
        }

        function updateBankingLayout(actionGrid) {
            actionGrid.innerHTML = `
                <div class="action-card">
                    <div class="action-icon">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="4" y="2" width="16" height="20" rx="2" ry="2"/>
                            <line x1="8" y1="6" x2="16" y2="6"/>
                            <line x1="8" y1="10" x2="16" y2="10"/>
                            <line x1="8" y1="14" x2="16" y2="14"/>
                            <line x1="8" y1="18" x2="12" y2="18"/>
                        </svg>
                    </div>
                    <div class="action-title">Loan Calculator</div>
                    <div class="action-desc">Estimate payments</div>
                </div>
                <div class="action-card">
                    <div class="action-icon">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"/>
                        </svg>
                    </div>
                    <div class="action-title">Upload Docs</div>
                    <div class="action-desc">Submit required files</div>
                </div>
                <div class="action-card">
                    <div class="action-icon">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="22,12 18,12 15,21 9,3 6,12 2,12"/>
                        </svg>
                    </div>
                    <div class="action-title">Current Rates</div>
                    <div class="action-desc">View live rates</div>
                </div>
                <div class="action-card" onclick="handleChatClick(this)">
                    <div class="action-icon">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/>
                        </svg>
                    </div>
                    <div class="action-title">Get Support</div>
                    <div class="action-desc">Chat with advisor</div>
                </div>
            `;
        }

        function updateRetailLayout(actionGrid) {
            actionGrid.innerHTML = `
                <div class="action-card">
                    <div class="action-icon">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M9 11H1a1 1 0 0 1-1-1V9a1 1 0 0 1 1-1h8a1 1 0 0 1 1 1v1a1 1 0 0 1-1 1z"/>
                            <path d="M23 11h-8a1 1 0 0 1-1-1V9a1 1 0 0 1 1-1h8a1 1 0 0 1 1 1v1a1 1 0 0 1-1 1z"/>
                            <path d="M9 19H1a1 1 0 0 1-1-1v-1a1 1 0 0 1 1-1h8a1 1 0 0 1 1 1v1a1 1 0 0 1-1 1z"/>
                            <path d="M23 19h-8a1 1 0 0 1-1-1v-1a1 1 0 0 1 1-1h8a1 1 0 0 1 1 1v1a1 1 0 0 1-1 1z"/>
                        </svg>
                    </div>
                    <div class="action-title">Shop Now</div>
                    <div class="action-desc">Browse collections</div>
                </div>
                <div class="action-card">
                    <div class="action-icon">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M6 2L3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4z"/>
                            <line x1="3" y1="6" x2="21" y2="6"/>
                            <path d="M16 10a4 4 0 0 1-8 0"/>
                        </svg>
                    </div>
                    <div class="action-title">My Cart</div>
                    <div class="action-desc">3 items</div>
                </div>
                <div class="action-card">
                    <div class="action-icon">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                        </svg>
                    </div>
                    <div class="action-title">Wishlist</div>
                    <div class="action-desc">12 items</div>
                </div>
                <div class="action-card" onclick="handleChatClick(this)">
                    <div class="action-icon">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/>
                        </svg>
                    </div>
                    <div class="action-title">Customer Care</div>
                    <div class="action-desc">Get help</div>
                </div>
            `;
        }

        function updateGamingLayout(actionGrid) {
            actionGrid.innerHTML = `
                <div class="action-card">
                    <div class="action-icon">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="10"/>
                            <circle cx="12" cy="10" r="3"/>
                            <path d="M7 20.662V19a2 2 0 0 1 2-2h6a2 2 0 0 1 2 2v1.662"/>
                        </svg>
                    </div>
                    <div class="action-title">Play Now</div>
                    <div class="action-desc">Continue Level 45</div>
                </div>
                <div class="action-card">
                    <div class="action-icon">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                        </svg>
                    </div>
                    <div class="action-title">Achievements</div>
                    <div class="action-desc">23 unlocked</div>
                </div>
                <div class="action-card">
                    <div class="action-icon">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M12 2v20M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/>
                        </svg>
                    </div>
                    <div class="action-title">Store</div>
                    <div class="action-desc">Buy coins & gems</div>
                </div>
                <div class="action-card" onclick="handleChatClick(this)">
                    <div class="action-icon">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/>
                        </svg>
                    </div>
                    <div class="action-title">Support</div>
                    <div class="action-desc">Get help</div>
                </div>
            `;
        }

        function updateHealthcareLayout(actionGrid) {
            actionGrid.innerHTML = `
                <div class="action-card">
                    <div class="action-icon">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M8 2v4M16 2v4M3 10h18M5 4h14a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2z"/>
                        </svg>
                    </div>
                    <div class="action-title">Appointments</div>
                    <div class="action-desc">Schedule visit</div>
                </div>
                <div class="action-card">
                    <div class="action-icon">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"/>
                        </svg>
                    </div>
                    <div class="action-title">Medical Records</div>
                    <div class="action-desc">View history</div>
                </div>
                <div class="action-card">
                    <div class="action-icon">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
                            <circle cx="8.5" cy="8.5" r="1.5"/>
                            <polyline points="21,15 16,10 5,21"/>
                        </svg>
                    </div>
                    <div class="action-title">Prescriptions</div>
                    <div class="action-desc">Refill meds</div>
                </div>
                <div class="action-card" onclick="handleChatClick(this)">
                    <div class="action-icon">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/>
                        </svg>
                    </div>
                    <div class="action-title">Health Chat</div>
                    <div class="action-desc">Ask questions</div>
                </div>
            `;
        }

        function updateHotelLayout(actionGrid) {
            actionGrid.innerHTML = `
                <div class="action-card">
                    <div class="action-icon">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/>
                            <polyline points="9,22 9,12 15,12 15,22"/>
                        </svg>
                    </div>
                    <div class="action-title">Book Room</div>
                    <div class="action-desc">Reserve suite</div>
                </div>
                <div class="action-card">
                    <div class="action-icon">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                        </svg>
                    </div>
                    <div class="action-title">Concierge</div>
                    <div class="action-desc">Luxury services</div>
                </div>
                <div class="action-card">
                    <div class="action-icon">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"/>
                            <path d="M13.73 21a2 2 0 0 1-3.46 0"/>
                        </svg>
                    </div>
                    <div class="action-title">Room Service</div>
                    <div class="action-desc">Order dining</div>
                </div>
                <div class="action-card" onclick="handleChatClick(this)">
                    <div class="action-icon">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/>
                        </svg>
                    </div>
                    <div class="action-title">Butler Chat</div>
                    <div class="action-desc">24/7 assistance</div>
                </div>
            `;
        }

        function updateWelcomeContent(userFirstName, applicationStage) {
            const industry = getSelectedIndustry();
            const welcomeTitle = document.getElementById('previewWelcomeTitle');
            const welcomeSubtitle = document.getElementById('previewWelcomeSubtitle');

            switch (industry) {
                case 'banking':
                    welcomeTitle.textContent = `Welcome back, ${userFirstName}!`;
                    welcomeSubtitle.textContent = `Let's get you closer to your dream home`;
                    break;
                case 'retail':
                    welcomeTitle.textContent = `Hello, ${userFirstName}!`;
                    welcomeSubtitle.textContent = `Discover the latest trends and styles`;
                    break;
                case 'gaming':
                    welcomeTitle.textContent = `Ready to play, ${userFirstName}?`;
                    welcomeSubtitle.textContent = `Your adventure continues at ${applicationStage}`;
                    break;
                case 'healthcare':
                    welcomeTitle.textContent = `Good health, ${userFirstName}!`;
                    welcomeSubtitle.textContent = `Your wellness journey continues`;
                    break;
                case 'hotel':
                    welcomeTitle.textContent = `Welcome, ${userFirstName}!`;
                    welcomeSubtitle.textContent = `Your luxury experience awaits`;
                    break;
                default:
                    welcomeTitle.textContent = `Welcome back, ${userFirstName}!`;
                    welcomeSubtitle.textContent = `Continue your ${applicationStage.toLowerCase()} process`;
            }
        }



        // Preview Control Functions
        function testPushNotification() {
            const notification = document.getElementById('preview-push-notification');
            const companyName = document.getElementById('companyName').value || 'Your Company';
            const userFirstName = document.getElementById('userFirstName').value || 'User';
            const applicationStage = document.getElementById('applicationStage').value || 'In Progress';
            const industry = getSelectedIndustry();

            // Update notification content with current config
            document.getElementById('previewNotificationApp').textContent = companyName;

            // Update notification content based on industry
            updateNotificationContent(userFirstName, applicationStage, industry);

            // Show the notification
            notification.classList.add('show');

            // Auto-dismiss after 5 seconds
            setTimeout(() => {
                notification.classList.remove('show');
            }, 5000);
        }

        function updateNotificationContent(userFirstName, applicationStage, industry) {
            const notificationTitle = document.getElementById('previewNotificationTitle');
            const notificationMessage = document.getElementById('previewNotificationMessage');
            const notificationIcon = document.getElementById('previewNotificationIcon');

            // Get custom notification content
            const customIcon = document.getElementById('pushNotificationIcon').value;
            const customTitle = document.getElementById('pushNotificationTitle').value;
            const customMessage = document.getElementById('pushNotificationMessage').value;

            // Use custom content if provided, otherwise use industry defaults
            if (customIcon && customTitle && customMessage) {
                notificationIcon.textContent = customIcon;
                notificationTitle.textContent = customTitle;
                notificationMessage.textContent = customMessage;
            } else {
                // Use industry-specific defaults
                const template = industryTemplates[industry];
                if (template && template.pushNotification) {
                    // Replace user name in the default title if it contains a placeholder
                    let defaultTitle = template.pushNotification.title;
                    if (defaultTitle.includes('Daisy')) {
                        defaultTitle = defaultTitle.replace('Daisy', userFirstName);
                    } else if (defaultTitle.includes('Sarah')) {
                        defaultTitle = defaultTitle.replace('Sarah', userFirstName);
                    } else if (defaultTitle.includes('Alex')) {
                        defaultTitle = defaultTitle.replace('Alex', userFirstName);
                    } else if (defaultTitle.includes('Dr. Johnson')) {
                        defaultTitle = defaultTitle.replace('Dr. Johnson', userFirstName);
                    } else if (defaultTitle.includes('Michael')) {
                        defaultTitle = defaultTitle.replace('Michael', userFirstName);
                    }

                    notificationIcon.textContent = template.pushNotification.icon;
                    notificationTitle.textContent = defaultTitle;
                    notificationMessage.textContent = template.pushNotification.message;
                } else {
                    // Fallback for custom industry
                    notificationIcon.textContent = 'üè†';
                    notificationTitle.textContent = `Welcome back, ${userFirstName}! üëã`;
                    notificationMessage.textContent = `Continue your ${applicationStage.toLowerCase()} process`;
                }
            }
        }

        function dismissPreviewNotification() {
            const notification = document.getElementById('preview-push-notification');
            notification.classList.remove('show');
        }

        async function testSunCoChat() {
            const chatOverlay = document.getElementById('preview-chat-overlay');
            const bottomOverlay = document.getElementById('preview-bottom-overlay');
            const companyName = document.getElementById('businessName').value || 'Your Company';
            const integrationId = document.getElementById('integrationId').value || '68124ef7dc2c6664100ff708';
            const industry = getSelectedIndustry();

            // Update chat title based on industry
            updateChatTitle(companyName, industry);

            // Show the chat overlay and bottom overlay
            chatOverlay.classList.add('active');
            bottomOverlay.style.display = 'block';

            // Initialize real SunCo widget
            await initializePreviewSunCo(integrationId, companyName);
        }

        function updateChatTitle(companyName, industry) {
            const chatTitle = document.getElementById('previewChatTitle');

            switch (industry) {
                case 'banking':
                    chatTitle.textContent = `${companyName} Support`;
                    break;
                case 'retail':
                    chatTitle.textContent = `${companyName} Customer Care`;
                    break;
                case 'gaming':
                    chatTitle.textContent = `${companyName} Support`;
                    break;
                case 'healthcare':
                    chatTitle.textContent = `${companyName} Health Chat`;
                    break;
                case 'hotel':
                    chatTitle.textContent = `${companyName} Concierge`;
                    break;
                default:
                    chatTitle.textContent = `${companyName} Support`;
            }
        }

        async function initializePreviewSunCo(integrationId, businessName) {
            // Use the same SunCo Web Messenger loader as the original demo
            if (typeof Smooch === 'undefined') {
                // Load SunCo Web Messenger using the same loader script
                const script = document.createElement('script');
                script.textContent = `
                    !function(o,p,s,e,c){
                        var i,a,h,u=[],d=[];function t(){var t="You must provide a supported major version.";try{if(!c)throw new Error(t);var e,n="https://cdn.smooch.io/",r="smooch";if((e="string"==typeof this.response?JSON.parse(this.response):this.response).url){var o=p.getElementsByTagName("script")[0],s=p.createElement("script");s.async=!0;var i=c.match(/([0-9]+).?([0-9]+)?.?([0-9]+)?/),a=i&&i[1];if(i&&i[3])s.src=n+r+"."+c+".min.js";else{if(!(4<=a&&e["v"+a]))throw new Error(t);s.src=e["v"+a]}o.parentNode.insertBefore(s,o)}}catch(e){e.message===t&&console.error(e)}}o[s]={init:function(){i=arguments;var t={then:function(e){return d.push({type:"t",next:e}),t},catch:function(e){return d.push({type:"c",next:e}),t}};return t},on:function(){u.push(arguments)},render:function(){a=arguments},destroy:function(){h=arguments}},o.__onWebMessengerHostReady__=function(e){if(delete o.__onWebMessengerHostReady__,o[s]=e,i)for(var t=e.init.apply(e,i),n=0;n<d.length;n++){var r=d[n];t="t"===r.type?t.then(r.next):t.catch(r.next)}a&&e.render.apply(e,a),h&&e.destroy.apply(e,h);for(n=0;n<u.length;n++)e.on.apply(e,u[n])};var n=new XMLHttpRequest;n.addEventListener("load",t),n.open("GET","https://"+e+".webloader.smooch.io/",!0),n.responseType="json",n.send()
                    }(window,document,"Smooch","${integrationId}","5");
                `;
                document.head.appendChild(script);

                // Wait for SunCo to be ready
                const checkSmooch = setInterval(async () => {
                    if (typeof Smooch !== 'undefined') {
                        clearInterval(checkSmooch);
                        await initPreviewSunCoWidget(integrationId, businessName);
                    }
                }, 100);
            } else {
                const container = document.getElementById('preview-sunco-container');
                await initPreviewSunCoWidget(integrationId, businessName, container);
            }
        }

        async function initPreviewSunCoWidget(integrationId, businessName, container) {

            // Clean up any existing widgets first
            cleanupAllSunCoWidgets();

            // Clear any existing content
            container.innerHTML = '';

            // Get authentication configuration
            const authConfig = getAuthenticationConfig();

            // Configure SunCo initialization options
            const initOptions = {
                integrationId: integrationId,
                embedded: true,
                canUserCreateMoreConversations: false,
                canUserSeeConversationList: false,
                businessName: businessName,
                businessIconUrl: document.getElementById('businessIconUrl').value || "https://t3.ftcdn.net/jpg/05/83/74/28/360_F_583742881_HNQwJVxhKDQ7M5LOdBQIYOGDHTOhfZva.jpg",
                customColors: {
                    brandColor: document.getElementById('primaryColor').value.replace('#', ''),
                    conversationColor: document.getElementById('secondaryColor').value.replace('#', ''),
                    actionColor: document.getElementById('accentColor').value.replace('#', '')
                },
                menuItems: {
                    imageUpload: true,
                    fileUpload: true,
                    shareLocation: false
                },
                soundNotificationEnabled: false
            };

            // Add authentication if enabled
            if (authConfig && authConfig.enabled) {
                console.log('Initializing preview SunCo with JWT authentication...');
                try {
                    const jwtToken = await generateJWTToken();
                    if (jwtToken) {
                        initOptions.jwt = jwtToken;
                        if (authConfig.externalId) {
                            initOptions.externalId = authConfig.externalId;
                        }
                    } else {
                        console.error('Failed to generate JWT token for preview');
                        return;
                    }
                } catch (error) {
                    console.error('Error generating JWT for preview:', error);
                    return;
                }
            } else {
                console.log('Initializing preview SunCo in non-authenticated mode...');
            }

            // Initialize SunCo
            Smooch.init(initOptions);

            // Render the widget in the preview container
            Smooch.render(container);

            // Handle ready event
            Smooch.on('ready', function () {
                console.log('Preview SunCo widget ready');

                // Create a conversation if none exists
                setTimeout(() => {
                    try {
                        // Try to create a conversation directly
                        Smooch.createConversation().then(function (conversation) {
                            console.log('Preview conversation created:', conversation);
                        }).catch(function (error) {
                            console.error('Error creating preview conversation:', error);
                        });
                    } catch (error) {
                        console.error('Error in preview SunCo ready handler:', error);
                    }
                }, 1000);
            });

            // Handle errors
            Smooch.on('error', function (error) {
                console.error('Preview SunCo error:', error);
            });
        }

        function closePreviewChat() {
            const chatOverlay = document.getElementById('preview-chat-overlay');
            const bottomOverlay = document.getElementById('preview-bottom-overlay');
            chatOverlay.classList.remove('active');
            bottomOverlay.style.display = 'none';

            // Clean up SunCo widget if it exists
            if (typeof Smooch !== 'undefined') {
                try {
                    Smooch.destroy();
                } catch (error) {
                    console.log('Preview SunCo widget cleanup:', error);
                }
            }
        }

        function closeDemoChat() {
            const demoPhoneScreen = document.getElementById('demoPhoneScreen');
            const chatOverlay = demoPhoneScreen.querySelector('.chat-overlay');
            document.getElementById('demoScreenFooter').style.display = 'none';

            if (chatOverlay) {
                chatOverlay.classList.remove('active');
            }

            // Clean up SunCo widget if it exists
            if (typeof Smooch !== 'undefined') {
                try {
                    Smooch.destroy();
                } catch (error) {
                    console.log('Demo SunCo widget cleanup:', error);
                }
            }
        }

        function cleanupAllSunCoWidgets() {
            if (typeof Smooch !== 'undefined') {
                try {
                    Smooch.destroy();
                } catch (error) {
                    console.log('All SunCo widgets cleanup:', error);
                }
            }
        }

        function resetPreview() {
            // Hide push notification
            dismissPreviewNotification();

            // Hide chat overlay
            closePreviewChat();

            // Reset any other preview states
            console.log('Preview reset');
        }

        function clearLocalStorage() {
            localStorage.clear();
            sessionStorage.clear();
            location.reload();
        }

        async function launchDemo() {
            const demoMode = document.getElementById('demoMode');
            const demoPhoneScreen = document.getElementById('demoPhoneScreen');
            const previewScreen = document.getElementById('previewScreen');
            const previewChatOverlay = document.getElementById('preview-chat-overlay');

            if (!demoMode || !demoPhoneScreen || !previewScreen) {
                console.warn('Required elements not found for demo launch');
                return;
            }

            // Clean up any existing SunCo widgets before switching modes
            cleanupAllSunCoWidgets();

            // Clone the preview phone content to demo mode
            demoPhoneScreen.innerHTML = previewScreen.innerHTML;

            // Also clone the chat overlay if it exists
            if (previewChatOverlay) {
                const demoChatOverlay = document.createElement('div');
                demoChatOverlay.className = 'chat-overlay';
                demoChatOverlay.innerHTML = previewChatOverlay.innerHTML;

                // Update the SunCo container ID to be unique for demo mode
                const demoSunCoContainer = demoChatOverlay.querySelector('#preview-sunco-container');
                if (demoSunCoContainer) {
                    demoSunCoContainer.id = 'demo-sunco-container';
                }

                // Update the chat close button to use demo-specific function
                const chatCloseBtn = demoChatOverlay.querySelector('.chat-close');
                if (chatCloseBtn) {
                    chatCloseBtn.onclick = closeDemoChat;
                }

                demoPhoneScreen.appendChild(demoChatOverlay);
            }

            // Update demo phone content with current configuration
            updateDemoContent();

            // Show demo mode
            demoMode.classList.add('active');

            // Hide body scroll
            document.body.style.overflow = 'hidden';
        }

        function exitDemo() {
            const demoMode = document.getElementById('demoMode');

            // Clean up any existing SunCo widgets before exiting demo
            cleanupAllSunCoWidgets();

            // Hide demo mode
            demoMode.classList.remove('active');

            // Restore body scroll
            document.body.style.overflow = 'auto';
        }

        function updateDemoContent() {
            const selectedIndustry = getSelectedIndustry();
            const appScreenshotUrl = document.getElementById('appScreenshotUrl').value;

            if (selectedIndustry === 'screenshot') {
                // In screenshot mode, only handle the screenshot
                const demoMainContent = demoPhoneScreen.querySelector('.main-content');

                if (appScreenshotUrl && appScreenshotUrl.trim() !== '') {
                    // Show custom app screenshot in demo with status bar overlay
                    const userName = document.getElementById('screenshotUserName').value || 'Sample App Name';
                    demoPhoneScreen.innerHTML = `
                        <div style="width: 100%; height: 100%; position: relative; overflow: hidden;">
                            <img src="${appScreenshotUrl}" alt="Custom app screenshot" style="width: 100%; height: 100%; object-fit: cover; border-radius: 0; box-shadow: none;">
                            <div class="status-bar" style="position: absolute; top: 0; left: 0; right: 0; z-index: 10;">
                                <span>9:41</span>
                                <span>${userName}</span>
                                <span>82%</span>
                            </div>
                            <div id="demoScreenFooter" style="position: absolute; bottom: 0; left: 0; right: 0; background: white; height: 55px; z-index: 5; border: none; display: none;"></div>
                        </div>
                    `;

                    // Add overlays to demo screenshot
                    addDemoOverlaysToScreenshot();
                } else {
                    // Show placeholder in demo with status bar
                    const userName = document.getElementById('screenshotUserName').value || 'Sample App Name';
                    demoMainContent.innerHTML = `
                        <div style="width: 100%; height: 100%; position: relative; background: #f8f9fa; border-radius: 8px; border: 2px dashed #dee2e6;">
                            <div class="status-bar" style="position: absolute; top: 0; left: 0; right: 0; z-index: 10;">
                                <span>9:41</span>
                                <span>${userName}</span>
                                <span>82%</span>
                            </div>
                            <div style="width: 100%; height: 100%; display: flex; flex-direction: column; align-items: center; justify-content: center; padding-top: 44px;">
                                <div style="font-size: 48px; margin-bottom: 16px; opacity: 0.5;">üì±</div>
                                <div style="font-size: 18px; font-weight: 600; color: #495057; margin-bottom: 8px; text-align: center;">Upload Your App Screenshot</div>
                                <div style="font-size: 14px; color: #6c757d; text-align: center; line-height: 1.4;">
                                    Enter an image URL to see your app<br>screenshot in the demo
                                </div>
                            </div>
                        </div>
                    `;
                }
                return;
            }

            // Update demo phone with current configuration for other industries
            const companyName = document.getElementById('companyName').value || 'Your Company';
            const tagline = document.getElementById('companyTagline').value || 'Your tagline here';
            const userFirstName = document.getElementById('userFirstName').value || 'User';
            const applicationProgress = document.getElementById('applicationProgress').value || 0;
            const applicationStage = document.getElementById('applicationStage').value || 'In Progress';

            // Update demo phone elements
            const demoStatusBar = demoPhoneScreen.querySelector('.status-bar span:nth-child(2)');
            const demoLogo = demoPhoneScreen.querySelector('.logo');
            const demoTagline = demoPhoneScreen.querySelector('.tagline');
            const demoWelcomeTitle = demoPhoneScreen.querySelector('.welcome-title');
            const demoWelcomeSubtitle = demoPhoneScreen.querySelector('.welcome-subtitle');
            const demoProgressFill = demoPhoneScreen.querySelector('.progress-fill');

            if (demoStatusBar) demoStatusBar.textContent = userFirstName + "'s phone";
            if (demoLogo) demoLogo.textContent = companyName;
            if (demoTagline) demoTagline.textContent = tagline;
            if (demoWelcomeTitle) demoWelcomeTitle.textContent = `Welcome back, ${userFirstName}!`;
            if (demoWelcomeSubtitle) demoWelcomeSubtitle.textContent = `Continue your ${applicationStage.toLowerCase()} process`;
            if (demoProgressFill) demoProgressFill.style.width = `${applicationProgress}%`;

            // Update app screenshot in demo if provided
            const demoMainContent = demoPhoneScreen.querySelector('.main-content');

            if (appScreenshotUrl && appScreenshotUrl.trim() !== '') {
                // Show custom app screenshot in demo for other industries
                const userName = document.getElementById('screenshotUserName').value || 'Sample App Name';
                demoPhoneScreen.innerHTML = `
                    <div style="width: 100%; height: 100%; position: relative; overflow: hidden;">
                        <img src="${appScreenshotUrl}" alt="Custom app screenshot" style="width: 100%; height: 100%; object-fit: cover; border-radius: 0; box-shadow: none;">
                        <div class="status-bar" style="position: absolute; top: 0; left: 0; right: 0; z-index: 10;">
                            <span>9:41</span>
                            <span>${userName}</span>
                            <span>82%</span>
                        </div>
                    </div>
                `;

                // Add overlays to demo screenshot for other industries
                addDemoOverlaysToScreenshot();
            } else {
                // Update UI layout based on selected industry
                updateDemoUILayout();
            }
        }

        function updateDemoUILayout() {
            const industry = getSelectedIndustry();
            const demoActionGrid = document.getElementById('demoPhoneScreen').querySelector('.action-grid');

            if (!demoActionGrid) return;

            // Clear existing actions
            demoActionGrid.innerHTML = '';

            switch (industry) {
                case 'banking':
                    updateBankingLayout(demoActionGrid);
                    break;
                case 'retail':
                    updateRetailLayout(demoActionGrid);
                    break;
                case 'gaming':
                    updateGamingLayout(demoActionGrid);
                    break;
                case 'healthcare':
                    updateHealthcareLayout(demoActionGrid);
                    break;
                case 'hotel':
                    updateHotelLayout(demoActionGrid);
                    break;
                default:
                    updateBankingLayout(demoActionGrid);
            }
        }

        function demoTestPushNotification() {
            const notification = document.getElementById('demoPhoneScreen').querySelector('.push-notification');
            const companyName = document.getElementById('companyName').value || 'Your Company';
            const userFirstName = document.getElementById('userFirstName').value || 'User';
            const applicationStage = document.getElementById('applicationStage').value || 'In Progress';
            const industry = getSelectedIndustry();

            // Update notification content with current config
            const notificationApp = notification.querySelector('.notification-app');
            const notificationTitle = notification.querySelector('.notification-title');
            const notificationMessage = notification.querySelector('.notification-message');
            const notificationIcon = notification.querySelector('.notification-icon');
            const demoScreenFooter = notification.querySelector('.demoScreenFooter');

            if (notificationApp) notificationApp.textContent = companyName;

            // Update notification content based on industry
            updateDemoNotificationContent(userFirstName, applicationStage, industry, notificationTitle, notificationMessage, notificationIcon);

            // Show the notification
            notification.classList.add('show');

            // Auto-dismiss after 5 seconds
            setTimeout(() => {
                notification.classList.remove('show');
            }, 5000);
        }

        function updateDemoNotificationContent(userFirstName, applicationStage, industry, titleEl, messageEl, iconEl) {
            // Get custom notification content
            const customIcon = document.getElementById('pushNotificationIcon').value;
            const customTitle = document.getElementById('pushNotificationTitle').value;
            const customMessage = document.getElementById('pushNotificationMessage').value;

            // Use custom content if provided, otherwise use industry defaults
            if (customIcon && customTitle && customMessage) {
                iconEl.textContent = customIcon;
                titleEl.textContent = customTitle;
                messageEl.textContent = customMessage;
            } else {
                // Use industry-specific defaults
                const template = industryTemplates[industry];
                if (template && template.pushNotification) {
                    // Replace user name in the default title if it contains a placeholder
                    let defaultTitle = template.pushNotification.title;
                    if (defaultTitle.includes('Daisy')) {
                        defaultTitle = defaultTitle.replace('Daisy', userFirstName);
                    } else if (defaultTitle.includes('Sarah')) {
                        defaultTitle = defaultTitle.replace('Sarah', userFirstName);
                    } else if (defaultTitle.includes('Alex')) {
                        defaultTitle = defaultTitle.replace('Alex', userFirstName);
                    } else if (defaultTitle.includes('Dr. Johnson')) {
                        defaultTitle = defaultTitle.replace('Dr. Johnson', userFirstName);
                    } else if (defaultTitle.includes('Michael')) {
                        defaultTitle = defaultTitle.replace('Michael', userFirstName);
                    }

                    iconEl.textContent = template.pushNotification.icon;
                    titleEl.textContent = defaultTitle;
                    messageEl.textContent = template.pushNotification.message;
                } else {
                    // Fallback for custom industry
                    iconEl.textContent = 'üè†';
                    titleEl.textContent = `Welcome back, ${userFirstName}! üëã`;
                    messageEl.textContent = `Continue your ${applicationStage.toLowerCase()} process`;
                }
            }
        }

        async function demoTestChat() {
            const chatOverlay = document.getElementById('demoPhoneScreen').querySelector('.chat-overlay');
            const companyName = document.getElementById('businessName').value || 'Your Company';
            const integrationId = document.getElementById('integrationId').value || '68124ef7dc2c6664100ff708';
            const industry = getSelectedIndustry();

            if (!chatOverlay) {
                console.error('Chat overlay not found in demo mode');
                return;
            }

            // Update chat title based on industry
            updateDemoChatTitle(companyName, industry);

            // Show the chat overlay
            chatOverlay.classList.add('active');

            // Initialize real SunCo widget
            await initializeDemoSunCo(integrationId, companyName);
        }

        function updateDemoChatTitle(companyName, industry) {
            const chatTitle = document.getElementById('demoPhoneScreen').querySelector('.chat-title');

            if (!chatTitle) {
                console.error('Chat title element not found in demo mode');
                return;
            }

            switch (industry) {
                case 'banking':
                    chatTitle.textContent = `${companyName} Support`;
                    break;
                case 'retail':
                    chatTitle.textContent = `${companyName} Customer Care`;
                    break;
                case 'gaming':
                    chatTitle.textContent = `${companyName} Support`;
                    break;
                case 'healthcare':
                    chatTitle.textContent = `${companyName} Health Chat`;
                    break;
                case 'hotel':
                    chatTitle.textContent = `${companyName} Concierge`;
                    break;
                default:
                    chatTitle.textContent = `${companyName} Support`;
            }
        }

        function demoClearChats() {
            localStorage.clear();
            sessionStorage.clear();
            // Don't reload the page in demo mode, just show a brief message
            const demoControls = document.getElementById('demoControls');
            const originalTitle = demoControls.querySelector('.demo-controls-title');
            originalTitle.textContent = 'Chats Cleared!';
            setTimeout(() => {
                originalTitle.textContent = 'Demo Controls';
            }, 2000);
        }

        async function initializeDemoSunCo(integrationId, businessName) {
            const container = document.getElementById('demoPhoneScreen').querySelector('#demo-sunco-container');

            document.getElementById('demoScreenFooter').style.display = 'block';

            if (!container) {
                console.error('SunCo container not found in demo mode');
                return;
            }

            // Clear any existing content
            container.innerHTML = '';

            // Initialize SunCo using non-authenticated mode
            console.log('Initializing demo SunCo in non-authenticated mode...');

            // Check if Smooch is already loaded, if not, load it
            if (typeof Smooch === 'undefined') {
                console.log('Smooch not loaded, loading now...');
                const script = document.createElement('script');
                script.textContent = `
                    !function(o,p,s,e,c){
                        var i,a,h,u=[],d=[];function t(){var t="You must provide a supported major version.";try{if(!c)throw new Error(t);var e,n="https://cdn.smooch.io/",r="smooch";if((e="string"==typeof this.response?JSON.parse(this.response):this.response).url){var o=p.getElementsByTagName("script")[0],s=p.createElement("script");s.async=!0;var i=c.match(/([0-9]+).?([0-9]+)?.?([0-9]+)?/),a=i&&i[1];if(i&&i[3])s.src=n+r+"."+c+".min.js";else{if(!(4<=a&&e["v"+a]))throw new Error(t);s.src=e["v"+a]}o.parentNode.insertBefore(s,o)}}catch(e){e.message===t&&console.error(e)}}o[s]={init:function(){i=arguments;var t={then:function(e){return d.push({type:"t",next:e}),t},catch:function(e){return d.push({type:"c",next:e}),t}};return t},on:function(){u.push(arguments)},render:function(){a=arguments},destroy:function(){h=arguments}},o.__onWebMessengerHostReady__=function(e){if(delete o.__onWebMessengerHostReady__,o[s]=e,i)for(var t=e.init.apply(e,i),n=0;n<d.length;n++){var r=d[n];t="t"===r.type?t.then(r.next):t.catch(r.next)}a&&e.render.apply(e,a),h&&e.destroy.apply(e,h);for(n=0;n<u.length;n++)e.on.apply(e,u[n])};var n=new XMLHttpRequest;n.addEventListener("load",t),n.open("GET","https://"+e+".webloader.smooch.io/",!0),n.responseType="json",n.send()
                    }(window,document,"Smooch","${integrationId}","5");
                `;
                document.head.appendChild(script);

                // Wait for Smooch to be ready
                const checkSmooch = setInterval(async () => {
                    if (typeof Smooch !== 'undefined') {
                        clearInterval(checkSmooch);
                        await initDemoSunCoWidget(integrationId, businessName, container);
                    }
                }, 100);
            } else {
                await initDemoSunCoWidget(integrationId, businessName, container);
            }
        }

        async function initDemoSunCoWidget(integrationId, businessName, container) {
            // Clean up any existing widgets first
            cleanupAllSunCoWidgets();

            // Clear any existing content
            container.innerHTML = '';

            // Get authentication configuration
            const authConfig = getAuthenticationConfig();

            // Configure SunCo initialization options
            const initOptions = {
                integrationId: integrationId,
                embedded: true,
                canUserCreateMoreConversations: false,
                canUserSeeConversationList: false,
                businessName: businessName,
                businessIconUrl: document.getElementById('businessIconUrl').value || "https://t3.ftcdn.net/jpg/05/83/74/28/360_F_583742881_HNQwJVxhKDQ7M5LOdBQIYOGDHTOhfZva.jpg",
                customColors: {
                    brandColor: document.getElementById('primaryColor').value.replace('#', ''),
                    conversationColor: document.getElementById('secondaryColor').value.replace('#', ''),
                    actionColor: document.getElementById('accentColor').value.replace('#', '')
                },
                menuItems: {
                    imageUpload: true,
                    fileUpload: true,
                    shareLocation: false
                },
                soundNotificationEnabled: false
            };

            // Add authentication if enabled
            if (authConfig && authConfig.enabled) {
                console.log('Initializing demo SunCo with JWT authentication...');
                try {
                    const jwtToken = await generateJWTToken();
                    if (jwtToken) {
                        initOptions.jwt = jwtToken;
                        if (authConfig.externalId) {
                            initOptions.externalId = authConfig.externalId;
                        }
                    } else {
                        console.error('Failed to generate JWT token for demo');
                        return;
                    }
                } catch (error) {
                    console.error('Error generating JWT for demo:', error);
                    return;
                }
            } else {
                console.log('Initializing demo SunCo in non-authenticated mode...');
            }

            // Initialize SunCo
            Smooch.init(initOptions);

            // Render the widget in the demo container
            Smooch.render(container);

            // Handle ready event
            Smooch.on('ready', function () {
                console.log('Demo SunCo widget ready');

                // Create a conversation if none exists
                setTimeout(() => {
                    try {
                        // Try to create a conversation directly
                        Smooch.createConversation().then(function (conversation) {
                            console.log('Demo conversation created:', conversation);
                        }).catch(function (error) {
                            console.error('Error creating demo conversation:', error);
                        });
                    } catch (error) {
                        console.error('Error in demo SunCo ready handler:', error);
                    }
                }, 1000);
            });

            // Handle errors
            Smooch.on('error', function (error) {
                console.error('Demo SunCo error:', error);
            });
        }

        function handleChatClick(element) {
            // Check if we're in demo mode
            const demoMode = document.getElementById('demoMode');
            if (demoMode.classList.contains('active')) {
                // We're in demo mode, use demo chat function
                demoTestChat();
            } else {
                // We're in preview mode, use regular chat function
                testSunCoChat();
            }
        }

        function handleNotificationChatClick() {
            // Check if we're in demo mode
            const demoMode = document.getElementById('demoMode');
            if (demoMode.classList.contains('active')) {
                // We're in demo mode, use demo chat function
                demoTestChat();
            } else {
                // We're in preview mode, use regular chat function
                testSunCoChat();
            }
        }

        function cleanupSunCoWidgets() {
            try {
                if (typeof Smooch !== 'undefined') {
                    // Only destroy if we're switching between modes, not within the same mode
                    console.log('SunCo widgets cleaned up');
                }
            } catch (error) {
                console.log('Error cleaning up SunCo widgets:', error);
            }
        }

        function preloadSunCo() {
            // Pre-load SunCo library with default integration ID
            const defaultIntegrationId = '68124ef7dc2c6664100ff708';

            if (typeof Smooch === 'undefined') {
                console.log('Pre-loading SunCo library...');
                const script = document.createElement('script');
                script.textContent = `
                    !function(o,p,s,e,c){
                        var i,a,h,u=[],d=[];function t(){var t="You must provide a supported major version.";try{if(!c)throw new Error(t);var e,n="https://cdn.smooch.io/",r="smooch";if((e="string"==typeof this.response?JSON.parse(this.response):this.response).url){var o=p.getElementsByTagName("script")[0],s=p.createElement("script");s.async=!0;var i=c.match(/([0-9]+).?([0-9]+)?.?([0-9]+)?/),a=i&&i[1];if(i&&i[3])s.src=n+r+"."+c+".min.js";else{if(!(4<=a&&e["v"+a]))throw new Error(t);s.src=e["v"+a]}o.parentNode.insertBefore(s,o)}}catch(e){e.message===t&&console.error(e)}}o[s]={init:function(){i=arguments;var t={then:function(e){return d.push({type:"t",next:e}),t},catch:function(e){return d.push({type:"c",next:e}),t}};return t},on:function(){u.push(arguments)},render:function(){a=arguments},destroy:function(){h=arguments}},o.__onWebMessengerHostReady__=function(e){if(delete o.__onWebMessengerHostReady__,o[s]=e,i)for(var t=e.init.apply(e,i),n=0;n<d.length;n++){var r=d[n];t="t"===r.type?t.then(r.next):t.catch(r.next)}a&&e.render.apply(e,a),h&&e.destroy.apply(e,h);for(n=0;n<u.length;n++)e.on.apply(e,u[n])};var n=new XMLHttpRequest;n.addEventListener("load",t),n.open("GET","https://"+e+".webloader.smooch.io/",!0),n.responseType="json",n.send()
                    }(window,document,"Smooch","${defaultIntegrationId}","5");
                `;
                document.head.appendChild(script);

                // Log when SunCo is ready
                const checkSmooch = setInterval(() => {
                    if (typeof Smooch !== 'undefined') {
                        clearInterval(checkSmooch);
                        console.log('SunCo library pre-loaded successfully');
                    }
                }, 100);
            } else {
                console.log('SunCo library already loaded');
            }
        }

        // Demo JWT Token Creation (for preview)
        function createPreviewJWT(userEmail, userName) {
            // This is a simplified demo JWT - in production, this would be generated server-side
            const header = {
                alg: 'HS256',
                typ: 'JWT',
                kid: 'demo-key-id'
            };

            const payload = {
                sub: userEmail,
                givenName: userName,
                email: userEmail,
                iat: Math.floor(Date.now() / 1000),
                exp: Math.floor(Date.now() / 1000) + (24 * 60 * 60), // 24 hours
                appId: document.getElementById('integrationId').value || '687fd954870b63e2f78a69bf'
            };

            // Create a mock JWT for demo purposes
            const encodedHeader = btoa(JSON.stringify(header));
            const encodedPayload = btoa(JSON.stringify(payload));

            return `${encodedHeader}.${encodedPayload}.demo_signature`;
        }



        function resetPushNotificationDefaults() {
            const industry = getSelectedIndustry();
            const template = industryTemplates[industry];

            if (template && template.pushNotification) {
                document.getElementById('pushNotificationIcon').value = template.pushNotification.icon;
                document.getElementById('pushNotificationTitle').value = template.pushNotification.title;
                document.getElementById('pushNotificationMessage').value = template.pushNotification.message;
                updatePreview();
            } else {
                // Clear fields for custom industry
                document.getElementById('pushNotificationIcon').value = '';
                document.getElementById('pushNotificationTitle').value = '';
                document.getElementById('pushNotificationMessage').value = '';
                updatePreview();
            }
        }

        function changeDeviceSize() {
            const deviceSize = document.getElementById('deviceSize').value;
            const phoneContainer = document.querySelector('.demo-phone-container');
            const phoneScreen = document.querySelector('.demo-phone-screen');

            // Device size configurations
            const deviceConfigs = {
                iphone: {
                    width: '375px',
                    height: '812px',
                    borderRadius: '40px',
                    screenBorderRadius: '32px',
                    padding: '8px'
                },
                android: {
                    width: '360px',
                    height: '720px',
                    borderRadius: '20px',
                    screenBorderRadius: '12px',
                    padding: '6px'
                },
                ipad: {
                    width: '576px',
                    height: '768px',
                    borderRadius: '20px',
                    screenBorderRadius: '12px',
                    padding: '8px'
                }
            };

            const config = deviceConfigs[deviceSize];

            if (config) {
                phoneContainer.style.width = config.width;
                phoneContainer.style.height = config.height;
                phoneContainer.style.borderRadius = config.borderRadius;
                phoneContainer.style.padding = config.padding;
                phoneScreen.style.borderRadius = config.screenBorderRadius;

                // Show a brief feedback message
                const demoControls = document.getElementById('demoControls');
                const originalTitle = demoControls.querySelector('.demo-controls-title');
                const deviceName = deviceSize.charAt(0).toUpperCase() + deviceSize.slice(1);
                originalTitle.textContent = `Switched to ${deviceName}`;
                setTimeout(() => {
                    originalTitle.textContent = 'Demo Controls';
                }, 2000);
            }
        }

        // Load cached Integration ID on page load
        document.addEventListener('DOMContentLoaded', function () {
            const cachedIntegrationId = localStorage.getItem('cachedIntegrationId');
            if (cachedIntegrationId) {
                document.getElementById('integrationId').value = cachedIntegrationId;
            }
        });

        // Save Integration ID to cache when user types
        document.getElementById('integrationId').addEventListener('input', function () {
            localStorage.setItem('cachedIntegrationId', this.value);
            // Save to history when user enters a valid Integration ID
            if (this.value && this.value.trim() !== '') {
                saveIntegrationIdToHistory(this.value);
            }
        });

        // Integration ID History functionality
        document.getElementById('integrationId').addEventListener('focus', function () {
            showIntegrationIdHistory();
        });

        document.getElementById('integrationId').addEventListener('blur', function () {
            // Delay hiding to allow clicking on dropdown items
            setTimeout(() => {
                hideIntegrationIdHistory();
            }, 200);
        });

        function toggleDemoControls() {
            const demoControls = document.getElementById('demoControls');
            const toggleBtn = demoControls.querySelector('.demo-toggle-btn');
            const hideBtn = demoControls.querySelector('.demo-control-btn[onclick="toggleDemoControls()"]');

            if (demoControls.classList.contains('collapsed')) {
                // Expand the panel
                demoControls.classList.remove('collapsed');
                toggleBtn.style.opacity = '0';
                toggleBtn.style.pointerEvents = 'none';
                if (hideBtn) {
                    hideBtn.innerHTML = 'üëÅÔ∏è Hide Panel';
                    hideBtn.style.background = 'linear-gradient(135deg, #6c757d, #5a6268)';
                }
            } else {
                // Collapse the panel
                demoControls.classList.add('collapsed');
                toggleBtn.style.opacity = '1';
                toggleBtn.style.pointerEvents = 'all';
                if (hideBtn) {
                    hideBtn.innerHTML = 'üëÅÔ∏è Show Panel';
                    hideBtn.style.background = 'linear-gradient(135deg, #28a745, #20c997)';
                }
            }
        }

        // URL History Functions
        function saveUrlToHistory(url) {
            if (!url || url.trim() === '') return;

            const history = getUrlHistory();
            const timestamp = new Date().toLocaleDateString();

            // Remove if already exists
            const existingIndex = history.findIndex(item => item.url === url);
            if (existingIndex !== -1) {
                history.splice(existingIndex, 1);
            }

            // Add to beginning
            history.unshift({ url, timestamp });

            // Keep only last 10 URLs
            if (history.length > 10) {
                history.pop();
            }

            localStorage.setItem('screenshotUrlHistory', JSON.stringify(history));
        }

        function getUrlHistory() {
            const history = localStorage.getItem('screenshotUrlHistory');
            return history ? JSON.parse(history) : [];
        }

        function showUrlHistory() {
            const dropdown = document.getElementById('urlHistoryDropdown');
            const history = getUrlHistory();

            if (history.length === 0) {
                dropdown.style.display = 'none';
                return;
            }

            dropdown.innerHTML = '';

            history.forEach(item => {
                const itemDiv = document.createElement('div');
                itemDiv.className = 'url-history-item';
                itemDiv.innerHTML = `
                    <div class="url-text">${item.url}</div>
                    <div class="url-date">Used on ${item.timestamp}</div>
                `;
                itemDiv.onclick = () => selectUrlFromHistory(item.url);
                dropdown.appendChild(itemDiv);
            });

            // Add clear history option
            const clearDiv = document.createElement('div');
            clearDiv.className = 'url-history-clear';
            clearDiv.textContent = 'Clear History';
            clearDiv.onclick = clearUrlHistory;
            dropdown.appendChild(clearDiv);

            dropdown.style.display = 'block';
        }

        function hideUrlHistory() {
            const dropdown = document.getElementById('urlHistoryDropdown');
            dropdown.style.display = 'none';
        }

        function selectUrlFromHistory(url) {
            document.getElementById('appScreenshotUrl').value = url;
            handleAppScreenshotUrl(url);
            hideUrlHistory();
        }

        function clearUrlHistory() {
            localStorage.removeItem('screenshotUrlHistory');
            hideUrlHistory();
        }

        // Integration ID History Functions
        function saveIntegrationIdToHistory(integrationId) {
            if (!integrationId || integrationId.trim() === '') return;

            const history = getIntegrationIdHistory();
            const timestamp = new Date().toLocaleDateString();

            // Remove if already exists
            const existingIndex = history.findIndex(item => item.integrationId === integrationId);
            if (existingIndex !== -1) {
                history.splice(existingIndex, 1);
            }

            // Add to beginning
            history.unshift({ integrationId, timestamp });

            // Keep only last 10 Integration IDs
            if (history.length > 10) {
                history.pop();
            }

            localStorage.setItem('integrationIdHistory', JSON.stringify(history));
        }

        function getIntegrationIdHistory() {
            const history = localStorage.getItem('integrationIdHistory');
            return history ? JSON.parse(history) : [];
        }

        function showIntegrationIdHistory() {
            const dropdown = document.getElementById('integrationIdHistoryDropdown');
            const history = getIntegrationIdHistory();

            if (history.length === 0) {
                dropdown.style.display = 'none';
                return;
            }

            dropdown.innerHTML = '';

            history.forEach(item => {
                const itemDiv = document.createElement('div');
                itemDiv.className = 'url-history-item';
                itemDiv.innerHTML = `
                    <div class="url-text">${item.integrationId}</div>
                    <div class="url-date">Used on ${item.timestamp}</div>
                `;
                itemDiv.onclick = () => selectIntegrationIdFromHistory(item.integrationId);
                dropdown.appendChild(itemDiv);
            });

            // Add clear history option
            const clearDiv = document.createElement('div');
            clearDiv.className = 'url-history-clear';
            clearDiv.textContent = 'Clear History';
            clearDiv.onclick = clearIntegrationIdHistory;
            dropdown.appendChild(clearDiv);

            dropdown.style.display = 'block';
        }

        function hideIntegrationIdHistory() {
            const dropdown = document.getElementById('integrationIdHistoryDropdown');
            dropdown.style.display = 'none';
        }

        function selectIntegrationIdFromHistory(integrationId) {
            document.getElementById('integrationId').value = integrationId;
            hideIntegrationIdHistory();
        }

        function clearIntegrationIdHistory() {
            localStorage.removeItem('integrationIdHistory');
            hideIntegrationIdHistory();
        }

        // Configuration Sharing Functions
        function shareConfiguration() {
            const config = getFullConfiguration();

            // Use encodeURIComponent + btoa to handle Unicode characters safely
            const configString = JSON.stringify(config);
            const encodedConfig = btoa(encodeURIComponent(configString));
            const shareUrl = `${window.location.origin}${window.location.pathname}?config=${encodedConfig}`;

            // Copy to clipboard
            navigator.clipboard.writeText(shareUrl).then(() => {
                // Show success message
                const button = event.target;
                const originalText = button.textContent;
                button.textContent = '‚úÖ Configuration Link Copied!';
                button.style.background = '#28a745';

                setTimeout(() => {
                    button.textContent = originalText;
                    button.style.background = '#667eea';
                }, 3000);
            }).catch(err => {
                console.error('Failed to copy: ', err);
                // Fallback: show the URL in a prompt
                prompt('Copy this configuration link:', shareUrl);
            });
        }

        function getFullConfiguration() {
            return {
                industry: getSelectedIndustry(),
                company: {
                    name: document.getElementById('companyName').value,
                    tagline: document.getElementById('companyTagline').value
                },
                colors: {
                    primary: document.getElementById('primaryColor').value,
                    secondary: document.getElementById('secondaryColor').value,
                    accent: document.getElementById('accentColor').value
                },
                user: {
                    firstName: document.getElementById('userFirstName').value,
                    lastName: document.getElementById('userLastName').value,
                    email: document.getElementById('userEmail').value
                },
                application: {
                    progress: document.getElementById('applicationProgress').value,
                    stage: document.getElementById('applicationStage').value
                },
                messaging: {
                    integrationId: document.getElementById('integrationId').value,
                    businessName: document.getElementById('businessName').value
                },
                authentication: {
                    enabled: document.getElementById('enableAuthentication').checked,
                    jwtSecret: document.getElementById('jwtSecret').value,
                    zendeskAppKey: document.getElementById('zendeskAppKey').value,
                    userName: document.getElementById('authUserName').value,
                    userEmail: document.getElementById('authUserEmail').value,
                    externalId: document.getElementById('authExternalId').value,
                    userProperties: document.getElementById('authUserProperties').value
                },
                pushNotification: {
                    icon: document.getElementById('pushNotificationIcon').value,
                    title: document.getElementById('pushNotificationTitle').value,
                    message: document.getElementById('pushNotificationMessage').value
                },
                screenshot: {
                    url: document.getElementById('appScreenshotUrl').value,
                    userName: document.getElementById('screenshotUserName').value
                }
            };
        }

        function loadConfigurationFromUrl() {
            const urlParams = new URLSearchParams(window.location.search);
            const configParam = urlParams.get('config');

            if (configParam) {
                try {
                    // Decode the Unicode-safe encoding (reverse of encodeURIComponent + btoa)
                    const decodedString = decodeURIComponent(atob(configParam));
                    const config = JSON.parse(decodedString);
                    applyConfiguration(config);

                    // Show notification that config was loaded
                    showConfigLoadedNotification();

                    // Clean up URL
                    const newUrl = window.location.origin + window.location.pathname;
                    window.history.replaceState({}, document.title, newUrl);

                } catch (error) {
                    console.error('Failed to load configuration from URL:', error);

                    // Try fallback decoding method for backward compatibility
                    try {
                        const config = JSON.parse(atob(configParam));
                        applyConfiguration(config);
                        showConfigLoadedNotification();

                        const newUrl = window.location.origin + window.location.pathname;
                        window.history.replaceState({}, document.title, newUrl);
                    } catch (fallbackError) {
                        console.error('Fallback decoding also failed:', fallbackError);
                        alert('Failed to load shared configuration. The link may be corrupted.');
                    }
                }
            }
        }

        function applyConfiguration(config) {
            // Select industry template
            if (config.industry) {
                document.querySelectorAll('.template-card').forEach(card => {
                    card.classList.remove('selected');
                    if (card.dataset.industry === config.industry) {
                        card.classList.add('selected');
                    }
                });

                // Handle screenshot section visibility
                const screenshotSection = document.getElementById('screenshotSection');
                if (config.industry === 'screenshot') {
                    screenshotSection.style.display = 'block';
                    hideStylingSections();
                } else {
                    screenshotSection.style.display = 'none';
                    showStylingSections();
                }
            }

            // Apply company settings
            if (config.company) {
                document.getElementById('companyName').value = config.company.name || '';
                document.getElementById('companyTagline').value = config.company.tagline || '';
            }

            // Apply colors
            if (config.colors) {
                document.getElementById('primaryColor').value = config.colors.primary || '#1a365d';
                document.getElementById('primaryColorText').value = config.colors.primary || '#1a365d';
                document.getElementById('secondaryColor').value = config.colors.secondary || '#2d5aa0';
                document.getElementById('secondaryColorText').value = config.colors.secondary || '#2d5aa0';
                document.getElementById('accentColor').value = config.colors.accent || '#4299e1';
                document.getElementById('accentColorText').value = config.colors.accent || '#4299e1';
            }

            // Apply user settings
            if (config.user) {
                document.getElementById('userFirstName').value = config.user.firstName || '';
                document.getElementById('userLastName').value = config.user.lastName || '';
                document.getElementById('userEmail').value = config.user.email || '';
            }

            // Apply application settings
            if (config.application) {
                document.getElementById('applicationProgress').value = config.application.progress || '0';
                document.getElementById('applicationStage').value = config.application.stage || '';
            }

            // Apply messaging settings
            if (config.messaging) {
                document.getElementById('integrationId').value = config.messaging.integrationId || '';
                document.getElementById('businessName').value = config.messaging.businessName || '';
            }

            // Apply authentication settings
            if (config.authentication) {
                document.getElementById('enableAuthentication').checked = config.authentication.enabled || false;
                document.getElementById('jwtSecret').value = config.authentication.jwtSecret || '';
                document.getElementById('zendeskAppKey').value = config.authentication.zendeskAppKey || '';
                document.getElementById('authUserName').value = config.authentication.userName || '';
                document.getElementById('authUserEmail').value = config.authentication.userEmail || '';
                document.getElementById('authExternalId').value = config.authentication.externalId || '';
                document.getElementById('authUserProperties').value = config.authentication.userProperties || '';
                toggleAuthenticationFields();
            }

            // Apply push notification settings
            if (config.pushNotification) {
                document.getElementById('pushNotificationIcon').value = config.pushNotification.icon || '';
                document.getElementById('pushNotificationTitle').value = config.pushNotification.title || '';
                document.getElementById('pushNotificationMessage').value = config.pushNotification.message || '';
            }

            // Apply screenshot settings
            if (config.screenshot) {
                document.getElementById('appScreenshotUrl').value = config.screenshot.url || '';
                document.getElementById('screenshotUserName').value = config.screenshot.userName || '';
                if (config.screenshot.url) {
                    handleAppScreenshotUrl(config.screenshot.url);
                }
            }

            // Update preview with loaded configuration
            updatePreview();
        }

        function showConfigLoadedNotification() {
            // Create notification element
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: #28a745;
                color: white;
                padding: 16px 24px;
                border-radius: 8px;
                box-shadow: 0 4px 12px rgba(0,0,0,0.15);
                z-index: 10000;
                font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
                font-size: 14px;
                font-weight: 500;
                max-width: 350px;
                animation: slideIn 0.3s ease-out;
            `;

            notification.innerHTML = `
                <div style="display: flex; align-items: center; gap: 8px;">
                    <span>‚úÖ</span>
                    <span>Configuration loaded successfully!</span>
                </div>
            `;

            // Add slideIn animation
            const style = document.createElement('style');
            style.textContent = `
                @keyframes slideIn {
                    from {
                        transform: translateX(100%);
                        opacity: 0;
                    }
                    to {
                        transform: translateX(0);
                        opacity: 1;
                    }
                }
            `;
            document.head.appendChild(style);

            document.body.appendChild(notification);

            // Remove notification after 4 seconds
            setTimeout(() => {
                notification.style.animation = 'slideIn 0.3s ease-out reverse';
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.parentNode.removeChild(notification);
                    }
                    if (style.parentNode) {
                        style.parentNode.removeChild(style);
                    }
                }, 300);
            }, 4000);
        }

        // Modal Functions
        function showAboutModal() {
            document.getElementById('aboutModal').style.display = 'flex';
        }

        function hideAboutModal() {
            document.getElementById('aboutModal').style.display = 'none';
        }

        // Close modal when clicking outside
        document.addEventListener('DOMContentLoaded', function () {
            const modal = document.getElementById('aboutModal');
            modal.addEventListener('click', function (e) {
                if (e.target === modal) {
                    hideAboutModal();
                }
            });
        });
    </script>
</body>

</html>